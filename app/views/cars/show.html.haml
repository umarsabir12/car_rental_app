- content_for :head do
  %meta{ name: "booked-dates", content: @booked_dates.to_json, "data-turbo-track" => "reload" }

%div.w-full.bg-gray-50.min-h-screen
  / Header Section
  .bg-white.border-b.py-4
    .max-w-7xl.mx-auto.px-4.sm:px-6.lg:px-8
      .flex.items-center.justify-between
        %h1.text-2xl.font-bold{style: 'color: #3a6363'}
          = "#{@car.brand} #{@car.model} #{@car.year} in Dubai"
        .flex.items-center.space-x-4
          %button.p-2.border.rounded-lg.hover:bg-gray-50
            %i.far.fa-heart
          %button.p-2.border.rounded-lg.hover:bg-gray-50
            %i.fas.fa-share-alt

  / Main Content
  .max-w-7xl.mx-auto.px-4.sm:px-6.lg:px-8.py-8
    .grid.grid-cols-1.lg:grid-cols-3.gap-8

      / Left Column - Images (2/3 width)
      .lg:col-span-2
        / Main Image Gallery
        .bg-white.rounded-xl.shadow-sm.overflow-hidden.mb-6
          - if @car.images.attached? && @car.images.any?
            .relative
              .swiper-container.h-80
                .swiper-wrapper
                  - @car.images.each do |image|
                    .swiper-slide
                      %img.w-full.h-full.object-cover{ src: url_for(image), alt: "#{@car.brand} #{@car.model}" }
                / Navigation
                .swiper-button-prev
                .swiper-button-next
                .swiper-pagination
              / Image Counter
              .absolute.top-4.right-4.bg-black.bg-opacity-50.text-white.px-3.py-1.rounded-full.text-sm
                %span.current-slide 1
                %span /
                %span.total-slides= @car.images.count
              / Thumbnail Strip
              .p-4.bg-gray-50
                .flex.space-x-2.overflow-x-auto
                  - @car.images.first(6).each_with_index do |image, index|
                    %img.w-16.h-12.object-cover.rounded.cursor-pointer.border-2.border-transparent.hover:border-blue-500{ src: url_for(image), alt: "Thumbnail #{index + 1}" }
          - else
            .h-80.bg-gray-200.flex.items-center.justify-center
              .text-center
                %i.fas.fa-car.text-gray-400.text-6xl.mb-4
                %p.text-gray-500 No images available

        / Rental Terms Card under gallery
        .bg-white.rounded-xl.shadow-sm.mb-6
          .px-6.py-4.border-b
            %h3.font-semibold.text-gray-900 Rental Terms
          .p-6
            .grid.grid-cols-1.sm:grid-cols-2.gap-x-10.gap-y-5.place-items-center.text-center
              .flex.items-center.justify-center.gap-3
                %i.fas.fa-tachometer-alt.text-xl.text-gray-700
                %span.text-gray-800 Mileage Policy
                %button.text-gray-400.hover:text-gray-600{ "data-policy" => "mileage" }
                  %i.fas.fa-info-circle
              .flex.items-center.justify-center.gap-3
                %i.fas.fa-gas-pump.text-xl.text-gray-700
                %span.text-gray-800 Fuel Policy
                %button.text-gray-400.hover:text-gray-600{ "data-policy" => "fuel" }
                  %i.fas.fa-info-circle
              .flex.items-center.justify-center.gap-3
                %i.fas.fa-file-alt.text-xl.text-gray-700
                %span.text-gray-800 Rental Policy
                %button.text-gray-400.hover:text-gray-600{ "data-policy" => "rental" }
                  %i.fas.fa-info-circle

        / Insurance Highlights
        .bg-white.rounded-xl.shadow-lg.mb-6
          .p-6
            .flex.flex-col.sm:flex-row.items-center.justify-center.gap-10.text-center
              .flex.items-center.gap-3
                %span.inline-flex.items-center.justify-center.w-6.h-6.rounded-full.bg-green-500.text-white
                  %i.fas.fa-check.text-xs
                %span.text-gray-800 Minimum 5 days rental
              .flex.items-center.gap-3
                %span.relative.group.inline-flex.items-center.justify-center.w-6.h-6.rounded-full.bg-green-500.text-white.cursor-pointer{ 'aria-describedby' => 'insurance-tooltip' }
                  %i.fas.fa-check.text-xs
                  %span#insurance-tooltip{ class: 'absolute left-1/2 -translate-x-1/2 bottom-full mb-2 w-64 rounded-lg bg-[#3A6363] text-white text-sm p-2 shadow-lg hidden group-hover:block whitespace-normal break-words z-10', role: 'tooltip' }
                    = @car.insurance_policy.present? ? @car.insurance_policy : 'No insurance policy provided'
                %span.text-gray-800 Insurance included

            / Right Column - Pricing & Booking (1/3 width)
      .lg:col-span-1
        / Vendor Info Card
        .bg-white.rounded-xl.shadow-sm.p-6.mb-6
          .flex.space-x-3
            %button.flex-1.bg-green-600.text-white.py-2.px-4.rounded-lg.text-sm
              %i.fab.fa-whatsapp.mr-2
              WhatsApp
            %button.flex-1.border.border-gray-300.py-2.px-4.rounded-lg.text-sm
              %i.fas.fa-phone.mr-2
              Call

        / Pricing Card - Three-tier selector
        .bg-white.rounded-xl.shadow-sm.p-6.mb-6{ "data-controller" => "pricing-selector" }
          .text-center.border-b.pb-4.mb-4
            %h3.text-lg.font-semibold.text-gray-800 Choose your plan
          .grid.grid-cols-1.sm:grid-cols-3.gap-3.mb-4
            - daily_price = @car.respond_to?(:daily_price) && @car.daily_price || 0
            - weekly_price = @car.respond_to?(:weekly_price) && @car.weekly_price || 0
            - monthly_price = @car.respond_to?(:monthly_price) && @car.monthly_price || 0
            - daily_mileage = @car.respond_to?(:daily_mileage) && @car.daily_mileage || @car.try(:daily_milleage) || 200
            - weekly_mileage = @car.respond_to?(:weekly_mileage) && @car.weekly_mileage || 1400
            - monthly_mileage = @car.respond_to?(:monthly_mileage) && @car.monthly_mileage || 6000
            - extra_charge = @car.respond_to?(:additional_mileage_charge) && @car.additional_mileage_charge || 1

            / Daily Card
            .cursor-pointer.border.rounded-xl.p-4.text-center.transition.shadow-sm.hover:shadow{ 
              "data-action" => "click->pricing-selector#select",
              "data-pricing-selector-target" => "card",
              "data-price" => daily_price,
              "data-period" => "daily",
              "data-mileage" => daily_mileage
            }
              %div.font-medium.uppercase.text-gray-500.mb-1 Daily
              %div.font-bold{style: 'color: #3a6363'} AED
              %div.font-extrabold{style: 'color: #3a6363'}= daily_price
              %div.text-xs.text-gray-500.mt-1 /day
              %div.mt-2.text-xs.text-gray-600 Includes
              %div.text-sm.font-medium= "#{daily_mileage} km"

            / Weekly Card
            .cursor-pointer.border.rounded-xl.p-4.text-center.transition.shadow-sm.hover:shadow{ 
              "data-action" => "click->pricing-selector#select",
              "data-pricing-selector-target" => "card",
              "data-price" => weekly_price,
              "data-period" => "weekly",
              "data-mileage" => weekly_mileage
            }
              %div.font-medium.uppercase.text-gray-500.mb-1 Weekly
              %div.font-bold{style: 'color: #3a6363'} AED
              %div.font-extrabold{style: 'color: #3a6363'}= weekly_price
              %div.text-xs.text-gray-500.mt-1 /week
              %div.mt-2.text-xs.text-gray-600 Includes
              %div.text-sm.font-medium= "#{weekly_mileage} km"

            / Monthly Card
            .cursor-pointer.border.rounded-xl.pt-4.text-center.transition.shadow-sm.hover:shadow{ 
              "data-action" => "click->pricing-selector#select",
              "data-pricing-selector-target" => "card",
              "data-price" => monthly_price,
              "data-period" => "monthly",
              "data-mileage" => monthly_mileage
            }
              %div.font-medium.uppercase.text-gray-500.mb-1 Monthly
              %div.font-bold{style: 'color: #3a6363'} AED
              %div.font-extrabold{style: 'color: #3a6363'}= monthly_price
              %div.text-xs.text-gray-500.mt-1 /month
              %div.mt-2.text-xs.text-gray-600 Includes
              %div.text-sm.font-medium= "#{monthly_mileage} km"

          / Mileage and charge info
          .space-y-3.text-sm
            .flex.justify-between
              %span Included mileage limit
              %span{ id: "includedMileageText", "data-pricing-selector-target" => "includedMileage" }= "#{daily_mileage} km"
            .flex.justify-between
              %span Additional mileage charge
              %span{ id: "additionalMileageText", "data-pricing-selector-target" => "additionalCharge" }= "AED #{extra_charge} /km"

          / Hidden inputs for booking submission
          = hidden_field_tag :selected_period, "daily", id: "selectedPeriodInput", "data-pricing-selector-target" => "selectedPeriod"
          = hidden_field_tag :selected_price, daily_price, id: "selectedPriceInput", "data-pricing-selector-target" => "selectedPrice"
          = hidden_field_tag :selected_mileage_limit, daily_mileage, id: "selectedMileageInput", "data-pricing-selector-target" => "selectedMileage"

          .border-t.pt-4.mt-4
            %button.w-full.py-3.px-4.rounded-lg.text-white.font-semibold{"data-bs-toggle" => "modal", "data-bs-target" => "#bookingModal", style: 'background-color: #3a6363'}
              Book This Car

  / Car Overview Section
  .max-w-7xl.mx-auto.px-4.sm:px-6.lg:px-8.pb-8
    .bg-white.rounded-xl.shadow-sm.p-8
      %h2.text-2xl.font-bold.mb-6{style: 'color: #2d4f4f'} CAR OVERVIEW
      
      .grid.grid-cols-2.md:grid-cols-3.lg:grid-cols-4.gap-6
        .flex.items-center.space-x-3
          %i.fas.fa-car.text-gray-400.w-5
          .div
            %span.text-sm.text-gray-500 Body Type
            %p.font-medium= @car.category || 'Sedan'
        
        .flex.items-center.space-x-3
          %i.fas.fa-calendar.text-gray-400.w-5
          .div
            %span.text-sm.text-gray-500 Model
            %p.font-medium= @car.year || '2021'
        
        .flex.items-center.space-x-3
          %i.fas.fa-palette.text-gray-400.w-5
          .div
            %span.text-sm.text-gray-500 Colour
            %p.font-medium= @car.color || 'Black'
        
        .flex.items-center.space-x-3
          %i.fas.fa-gas-pump.text-gray-400.w-5
          .div
            %span.text-sm.text-gray-500 Fuel
            %p.font-medium= @car.fuel_type || 'Petrol'
        
        .flex.items-center.space-x-3
          %i.fas.fa-tachometer-alt.text-gray-400.w-5
          .div
            %span.text-sm.text-gray-500 Mileage
            %p.font-medium= @car.mileage || '50,000'
        
        .flex.items-center.space-x-3
          %i.fas.fa-cogs.text-gray-400.w-5
          .div
            %span.text-sm.text-gray-500 Transmission
            %p.font-medium= @car.transmission || 'Auto'
        
        .flex.items-center.space-x-3
          %i.fas.fa-users.text-gray-400.w-5
          .div
            %span.text-sm.text-gray-500 Seating Capacity
            %p.font-medium= "#{@car.seats || 5} passengers"
        
        .flex.items-center.space-x-3
          %i.fas.fa-engine.text-gray-400.w-5
          .div
            %span.text-sm.text-gray-500 Engine CC
            %p.font-medium= @car.engine_size || '2.0L'

  / Features & Specs Section
  .max-w-7xl.mx-auto.px-4.sm:px-6.lg:px-8.pb-8
    .bg-white.rounded-xl.shadow-sm.p-8
      %h2.text-2xl.font-bold.mb-6{style: 'color: #2d4f4f'} FEATURES & SPECS
      
      .grid.grid-cols-1.md:grid-cols-2.gap-8
        .div
          %h3.font-semibold.mb-4.text-gray-700 Technical Features
          .space-y-3
            .flex.items-center
              - if @car.air_conditioning
                %i.fas.fa-check-circle.text-green-500.mr-3
              - else
                %i.fas.fa-times-circle.text-red-500.mr-3
              %span Automatic Emergency Braking
            .flex.items-center
              - if @car.bluetooth
                %i.fas.fa-check-circle.text-green-500.mr-3
              - else
                %i.fas.fa-times-circle.text-red-500.mr-3
              %span Bluetooth Connectivity
            .flex.items-center
              %i.fas.fa-check-circle.text-green-500.mr-3
              %span Power Windows
            .flex.items-center
              %i.fas.fa-check-circle.text-green-500.mr-3
              %span Power Door Locks

        .div
          %h3.font-semibold.mb-4.text-gray-700 Other Features
          .space-y-3
            .flex.items-center
              - if @car.sunroof
                %i.fas.fa-check-circle.text-green-500.mr-3
              - else
                %i.fas.fa-times-circle.text-red-500.mr-3
              %span Panoramic Sunroof
            .flex.items-center
              - if @car.gps
                %i.fas.fa-check-circle.text-green-500.mr-3
              - else
                %i.fas.fa-times-circle.text-red-500.mr-3
              %span GPS Navigation
            .flex.items-center
              %i.fas.fa-check-circle.text-green-500.mr-3
              %span USB Chargers
            .flex.items-center
              %i.fas.fa-check-circle.text-green-500.mr-3
              %span LED Screens

  / Requirements Section
  .max-w-7xl.mx-auto.px-4.sm:px-6.lg:px-8.pb-8
    .bg-white.rounded-xl.shadow-sm.p-8
      %h2.text-2xl.font-bold.mb-6{style: 'color: #2d4f4f'} REQUIREMENTS TO RENT THIS CAR
      .grid.grid-cols-1.lg:grid-cols-2.gap-8
        / Card: UAE Residents
        .rounded-3xl.border.border-gray-200.bg-white.shadow-sm.overflow-hidden
          .bg-gray-100.py-4.text-center
            %h3.text-lg.font-semibold.text-gray-800 For UAE Residents
          .p-6
            .grid.grid-cols-1.md:grid-cols-2.gap-6.items-center
              %div.flex.items-end.justify-center
                %img{class: 'w-64 h-40 object-contain', src: asset_path('hero_cars/car3.png'), alt: 'UAE Resident documents'}
              %ul.space-y-4
                %li.flex.items-start.gap-3
                  %span.inline-flex.items-center.justify-center.rounded-full.w-6.h-6{style: 'background-color: #e8f1f1; color: #3a6363'}
                    %i{class: 'fas fa-check text-sm'}
                  %span.text-gray-700 UAE Driving License
                %li.flex.items-start.gap-3
                  %span.inline-flex.items-center.justify-center.rounded-full.w-6.h-6{style: 'background-color: #e8f1f1; color: #3a6363'}
                    %i{class: 'fas fa-check text-sm'}
                  %span.text-gray-700 Emirates ID
                %li.flex.items-start.gap-3
                  %span.text-gray-700 (Residential Visa may be acceptable)
        
        / Card: Tourists visiting the UAE
        .rounded-3xl.border.border-gray-200.bg-white.shadow-sm.overflow-hidden
          .bg-gray-100.py-4.text-center
            %h3.text-lg.font-semibold.text-gray-800 For Tourists visiting the UAE
          .p-6
            .grid.grid-cols-1.md:grid-cols-2.gap-6.items-center
              %div.flex.items-end.justify-center
                %img{class: 'w-64 h-40 object-contain', src: asset_path('hero_cars/car4.png'), alt: 'Tourist documents'}
              %ul.space-y-4
                %li.flex.items-start.gap-3
                  %span.inline-flex.items-center.justify-center.rounded-full.w-6.h-6{style: 'background-color: #e8f1f1; color: #3a6363'}
                    %i{class: 'fas fa-check text-sm'}
                  %span.text-gray-700 Passport
                %li.flex.items-start.gap-3
                  %span.inline-flex.items-center.justify-center.rounded-full.w-6.h-6{style: 'background-color: #e8f1f1; color: #3a6363'}
                    %i{class: 'fas fa-check text-sm'}
                  %span.text-gray-700 Visit Visa
                %li.flex.items-start.gap-3
                  %span.inline-flex.items-center.justify-center.rounded-full.w-6.h-6{style: 'background-color: #e8f1f1; color: #3a6363'}
                    %i{class: 'fas fa-check text-sm'}
                  %span.text-gray-700 Home Country Driving License
                %li.flex.items-start.gap-3
                  %span.inline-flex.items-center.justify-center.rounded-full.w-6.h-6{style: 'background-color: #e8f1f1; color: #3a6363'}
                    %i{class: 'fas fa-check text-sm'}
                  %span.text-gray-700 International Driving Permit (IDP)

  / FAQ Section
  .max-w-7xl.mx-auto.px-4.sm:px-6.lg:px-8.pb-8
    .bg-white.rounded-xl.shadow-sm.p-8
      %h2.text-2xl.font-bold.mb-6{style: 'color: #2d4f4f'} FREQUENTLY ASKED QUESTIONS
      .space-y-4
        .border-b.pb-4
          %h4.font-semibold.mb-2 What documents do I need to rent this car?
          %p.text-gray-600 You'll need a valid UAE driving license, Emirates ID or passport, and a credit card for the security deposit.
        .border-b.pb-4
          %h4.font-semibold.mb-2 Is fuel included in the rental price?
          %p.text-gray-600 No, fuel is not included. You'll need to return the car with the same fuel level.

  / Recommended Cars Section
  - if @recommended_cars&.any?
    .max-w-7xl.mx-auto.px-4.sm:px-6.lg:px-8.pb-8
      .bg-white.rounded-xl.shadow-sm.p-8
        %h2.text-2xl.font-bold.mb-6{style: 'color: #2d4f4f'} RECOMMENDED CAR RENTALS
        .grid.grid-cols-1.md:grid-cols-2.lg:grid-cols-4.gap-6
          - @recommended_cars.each do |car|
            = link_to car_path(car), class: 'block bg-white border rounded-xl overflow-hidden hover:shadow-md transition-shadow' do
              - if car.images.attached? && car.images.any?
                %img.w-full.h-32.object-cover{ src: url_for(car.images.first), alt: "#{car.brand} #{car.model}" }
              - else
                .w-full.h-32.bg-gray-200.flex.items-center.justify-center
                  %i.fas.fa-car.text-gray-400.text-2xl
              .p-4
                %h3.font-semibold.text-sm.mb-1= "#{car.brand} #{car.model}"
                .text-xs.text-gray-500.mb-2= car.year
                .flex.justify-between.items-center
                  .text-sm.font-bold{style: 'color: #3a6363'}
                    = car.daily_price ? "AED #{car.daily_price}" : 'AED 0'
                  .text-xs.text-gray-400 /day

/ Booking Modal (keeping your existing modal)
#bookingModal.modal.fade{"aria-hidden" => "true", "aria-labelledby" => "bookingModalLabel", tabindex: "-1", "data-controller" => "modal"}
  .modal-dialog.modal-dialog-centered.mt-16
    .modal-content.rounded-2xl.shadow-xl.border{style: 'border-color: #cfe5e5'}
      .modal-header.flex.items-center.justify-between.px-6.py-4
        %h5#bookingModalLabel.modal-title.text-xl.font-bold{style: 'color: #2d4f4f'} Book This Car
        %button.text-gray-400.hover:text-gray-600.transition{"aria-label" => "Close", "data-bs-dismiss" => "modal", type: "button"}
          %i.fas.fa-times

      .modal-body.bg-white.px-6.py-4
        .mb-4
          %label.block.text-sm.font-medium.mb-1{style: 'color: #2d4f4f'} Pickup Date
          = text_field_tag :start_date, nil, required: true, class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 flatpickr", autocomplete: "off", id: "startDateInput", style: "--tw-ring-color:#3a6363"

        .mb-4
          %label.block.text-sm.font-medium.mb-1{style: 'color: #2d4f4f'} Return Date
          = text_field_tag :end_date, nil, required: true, class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 flatpickr", autocomplete: "off", id: "endDateInput", style: "--tw-ring-color:#3a6363"

      .modal-footer.flex.justify-end.gap-4.px-6.py-4
        %button.bg-gray-200.text-gray-700.font-semibold.px-5.py-2.rounded-lg.hover:bg-gray-300.transition{ "data-bs-dismiss" => "modal", type: "button" } Close
        - if user_signed_in?
          %button.text-white.font-semibold.px-6.py-2.rounded-lg.shadow-md.transition{ type: "button", id: "createBookingBtn", disabled: true, style: "pointer-events: none; opacity: 0.5; background-color: #3a6363" } Create Booking
        - else
          %a.text-white.font-semibold.px-6.py-2.rounded-lg.shadow-md.transition{ href: "#", id: "continueToLoginLink", disabled: true, style: "pointer-events: none; opacity: 0.5; background-color: #3a6363" } Continue to Sign In

/ Right-side Drawer for policy info
#policyDrawer.fixed.top-0.right-0.h-full.w-96.bg-white.shadow-2xl.transform.translate-x-full.transition-transform.duration-300.z-50{ 'aria-hidden' => 'true' }
  .flex.items-center.justify-between.px-5.py-4.border-b
    %h5#policyDrawerTitle.text-lg.font-bold{style: 'color:#2d4f4f'} Policy Details
    %button#closePolicyDrawer.text-gray-400.hover:text-gray-600{ type: 'button', 'aria-label' => 'Close' }
      %i.fas.fa-times
  .p-5.overflow-y-auto.h-full
    #policyDrawerContent.text-gray-700
      / Content populated by JavaScript

:javascript
  document.addEventListener("DOMContentLoaded", function () {
    const continueBtn = document.getElementById("continueToLoginLink");
    const createBookingBtn = document.getElementById("createBookingBtn");
    const startInput = document.getElementById("startDateInput");
    const endInput = document.getElementById("endDateInput");

    function updateButtonState() {
      if (startInput.value && endInput.value) {
        if (continueBtn) {
          continueBtn.removeAttribute("disabled");
          continueBtn.style.pointerEvents = "auto";
          continueBtn.style.opacity = "1";
        }
        if (createBookingBtn) {
          createBookingBtn.removeAttribute("disabled");
          createBookingBtn.style.pointerEvents = "auto";
          createBookingBtn.style.opacity = "1";
        }
      } else {
        if (continueBtn) {
          continueBtn.setAttribute("disabled", "true");
          continueBtn.style.pointerEvents = "none";
          continueBtn.style.opacity = "0.5";
        }
        if (createBookingBtn) {
          createBookingBtn.setAttribute("disabled", "true");
          createBookingBtn.style.pointerEvents = "none";
          createBookingBtn.style.opacity = "0.5";
        }
      }
    }

    startInput.addEventListener("change", updateButtonState);
    endInput.addEventListener("change", updateButtonState);

    if (continueBtn) {
      continueBtn.addEventListener("click", function (e) {
        if (!startInput.value || !endInput.value) {
          e.preventDefault();
          alert("Please select both start and end dates.");
          return;
        }
        e.preventDefault();
        const carId = "#{@car.id}";
        const startDate = startInput.value;
        const endDate = endInput.value;
        const selectedPeriod = document.getElementById("selectedPeriodInput")?.value || "daily";
        const selectedPrice = document.getElementById("selectedPriceInput")?.value || "0";
        const selectedMileage = document.getElementById("selectedMileageInput")?.value || "0";
        const queryParams = new URLSearchParams({
          car_id: carId,
          start_date: startDate,
          end_date: endDate,
          selected_period: selectedPeriod,
          selected_price: selectedPrice,
          selected_mileage_limit: selectedMileage
        });
        window.location.href = "/users/sign_in?" + queryParams.toString();
      });
    }

    if (createBookingBtn) {
      createBookingBtn.addEventListener("click", function (e) {
        if (!startInput.value || !endInput.value) {
          e.preventDefault();
          alert("Please select both start and end dates.");
          return;
        }
        e.preventDefault();
        const formData = new FormData();
        formData.append('booking[car_id]', "#{@car.id}");
        formData.append('booking[start_date]', startInput.value);
        formData.append('booking[end_date]', endInput.value);
        formData.append('booking[selected_period]', document.getElementById("selectedPeriodInput")?.value || 'daily');
        formData.append('booking[selected_price]', document.getElementById("selectedPriceInput")?.value || '0');
        formData.append('booking[selected_mileage_limit]', document.getElementById("selectedMileageInput")?.value || '0');
        fetch('/bookings', {
          method: 'POST',
          body: formData,
          headers: {
            'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
          }
        })
        .then(response => {
          if (response.redirected) {
            window.location.href = response.url;
          } else {
            if (response.ok) {
              return response.text();
            } else {
              throw new Error('Booking creation failed');
            }
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('There was an error creating your booking. Please check your dates and try again.');
        });
      });
    }

:javascript
  document.addEventListener("DOMContentLoaded", function () {
    // Booking Modal Logic
    const continueBtn = document.getElementById("continueToLoginLink");
    const createBookingBtn = document.getElementById("createBookingBtn");
    const startInput = document.getElementById("startDateInput");
    const endInput = document.getElementById("endDateInput");

    function updateButtonState() {
      if (startInput.value && endInput.value) {
        if (continueBtn) {
          continueBtn.removeAttribute("disabled");
          continueBtn.style.pointerEvents = "auto";
          continueBtn.style.opacity = "1";
        }
        if (createBookingBtn) {
          createBookingBtn.removeAttribute("disabled");
          createBookingBtn.style.pointerEvents = "auto";
          createBookingBtn.style.opacity = "1";
        }
      } else {
        if (continueBtn) {
          continueBtn.setAttribute("disabled", "true");
          continueBtn.style.pointerEvents = "none";
          continueBtn.style.opacity = "0.5";
        }
        if (createBookingBtn) {
          createBookingBtn.setAttribute("disabled", "true");
          createBookingBtn.style.pointerEvents = "none";
          createBookingBtn.style.opacity = "0.5";
        }
      }
    }

    if (startInput && endInput) {
      startInput.addEventListener("change", updateButtonState);
      endInput.addEventListener("change", updateButtonState);
      updateButtonState();
    }

    if (continueBtn) {
      continueBtn.addEventListener("click", function (e) {
        if (!startInput.value || !endInput.value) {
          e.preventDefault();
          alert("Please select both start and end dates.");
          return;
        }
        e.preventDefault();
        const carId = "#{@car.id}";
        const startDate = startInput.value;
        const endDate = endInput.value;
        const selectedPeriod = document.getElementById("selectedPeriodInput")?.value || "daily";
        const selectedPrice = document.getElementById("selectedPriceInput")?.value || "0";
        const selectedMileage = document.getElementById("selectedMileageInput")?.value || "0";
        const queryParams = new URLSearchParams({
          car_id: carId,
          start_date: startDate,
          end_date: endDate,
          selected_period: selectedPeriod,
          selected_price: selectedPrice,
          selected_mileage_limit: selectedMileage
        });
        window.location.href = "/users/sign_in?" + queryParams.toString();
      });
    }

    if (createBookingBtn) {
      createBookingBtn.addEventListener("click", function (e) {
        if (!startInput.value || !endInput.value) {
          e.preventDefault();
          alert("Please select both start and end dates.");
          return;
        }
        e.preventDefault();
        const formData = new FormData();
        formData.append('booking[car_id]', "#{@car.id}");
        formData.append('booking[start_date]', startInput.value);
        formData.append('booking[end_date]', endInput.value);
        formData.append('booking[selected_period]', document.getElementById("selectedPeriodInput")?.value || 'daily');
        formData.append('booking[selected_price]', document.getElementById("selectedPriceInput")?.value || '0');
        formData.append('booking[selected_mileage_limit]', document.getElementById("selectedMileageInput")?.value || '0');
        fetch('/bookings', {
          method: 'POST',
          body: formData,
          headers: {
            'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
          }
        })
        .then(response => {
          if (response.redirected) {
            window.location.href = response.url;
          } else {
            if (response.ok) {
              return response.text();
            } else {
              throw new Error('Booking creation failed');
            }
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('There was an error creating your booking. Please check your dates and try again.');
        });
      });
    }

    // Policy Drawer Logic
    const policyContent = {
      mileage: {
        title: 'Mileage Policy',
        content: 'This rental includes limited mileage. Additional charges apply for exceeding the daily mileage limit of ' + (#{@car.daily_milleage || 200}) + ' km per day. Extra mileage is charged at AED 1 per kilometer.'
      },
      fuel: {
        title: 'Fuel Policy',
        content: 'The vehicle will be provided with a full tank of fuel. You are required to return the vehicle with the same fuel level. If returned with less fuel, you will be charged for refueling at current market rates plus a service fee.'
      },
      deposit: {
        title: 'Deposit Policy',  
        content: 'A security deposit of AED 1500 is required and will be blocked on your credit card. This deposit covers any potential damages, traffic fines, or additional charges. The deposit will be released within 7-10 business days after the rental return, subject to no claims.'
      },
      rental: {
        title: 'Rental Policy',
        content: 'Minimum rental age is 21 years. A valid UAE driving license is required for UAE residents, or an International Driving Permit for tourists. The renter is responsible for all traffic fines incurred during the rental period. Vehicle must be returned to the same location unless prior arrangements are made.'
      },
      min_days: {
        title: 'Minimum Rental Duration',
        content: 'The minimum rental period for this vehicle is 5 days. Shorter durations are not eligible for booking and pricing is calculated on a per-day basis.'
      }
    };

    function openPolicyDrawer(title, content) {
      const drawer = document.getElementById('policyDrawer');
      const titleEl = document.getElementById('policyDrawerTitle');
      const contentEl = document.getElementById('policyDrawerContent');
      if (!drawer || !titleEl || !contentEl) return;
      titleEl.textContent = title;
      contentEl.innerHTML = '<p>' + content + '</p>';
      drawer.setAttribute('aria-hidden', 'false');
      drawer.classList.remove('translate-x-full');
    }

    function closePolicyDrawer() {
      const drawer = document.getElementById('policyDrawer');
      if (!drawer) return;
      drawer.setAttribute('aria-hidden', 'true');
      drawer.classList.add('translate-x-full');
    }

    const closeBtn = document.getElementById('closePolicyDrawer');
    if (closeBtn) {
      closeBtn.addEventListener('click', closePolicyDrawer);
    }

    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closePolicyDrawer();
      }
    });

    document.querySelectorAll('[data-policy]').forEach(button => {
      button.addEventListener('click', function(e) {
        const policyType = this.getAttribute('data-policy');
        const policy = policyContent[policyType];
        if (!policy) return;
        e.preventDefault();
        openPolicyDrawer(policy.title, policy.content);
      });
    });
  });

  // Swiper initialization
  document.addEventListener('DOMContentLoaded', function() {
    if (window.Swiper) {
      new Swiper('.swiper-container', {
        loop: true,
        navigation: {
          nextEl: '.swiper-button-next',
          prevEl: '.swiper-button-prev',
        },
        pagination: {
          el: '.swiper-pagination',
          clickable: true,
        },
        slidesPerView: 1,
        spaceBetween: 20,
        centeredSlides: true,
        autoHeight: true,
      });
    }
  });