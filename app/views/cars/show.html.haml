- content_for :title, "Rent #{@car.full_name} in Dubai | Wheels on Rent"
- content_for :description, "Rent #{@car.full_name} in Dubai starting from AED #{@car.daily_price}/day.}"
- content_for :canonical, car_url(@car)
- min_days = ['Luxury', 'Sports', 'Convertible'].include?(@car.category) ? 1 : 7

- content_for :head do
  %meta{ name: "booked-dates", content: @booked_dates.to_json, "data-turbo-track" => "reload" }
  :css
    /* Car show page specific navbar styling */
    nav {
      background: rgba(255, 255, 255, 0.9) !important;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1) !important;
    }
    nav .text-white {
      color: #374151 !important;
    }
    nav .text-white:hover {
      color: #111827 !important;
    }

    /* Custom scrollbar for thumbnails */
    .thumbnail-image {
      flex-shrink: 0;
    }
    
    .overflow-x-auto::-webkit-scrollbar {
      height: 8px;
    }
    
    .overflow-x-auto::-webkit-scrollbar-track {
      background: #e5e7eb;
      border-radius: 4px;
    }
    
    .overflow-x-auto::-webkit-scrollbar-thumb {
      background: #3a6363;
      border-radius: 4px;
    }
    
    .overflow-x-auto::-webkit-scrollbar-thumb:hover {
      background: #2d4d4d;
    }
    
    /* Smooth transitions for swiper */
    .swiper-slide img {
      transition: transform 0.3s ease;
    }
    
    /* Navigation button styling */
    .swiper-button-prev::after,
    .swiper-button-next::after {
      font-size: 24px !important;
      font-weight: bold;
    }
    
    /* Pagination styling */
    .swiper-pagination-bullet {
      background: #3a6363;
      opacity: 0.5;
    }
    
    .swiper-pagination-bullet-active {
      opacity: 1;
      transform: scale(1.2);
    }

%div.w-full.bg-gray-50.min-h-screen.pt-16
  / Header Section
  .bg-white.border-b.py-4
    .max-w-7xl.mx-auto.px-4.sm:px-6.lg:px-8
      .flex.items-center.justify-between
        %h1.text-2xl.font-bold{style: 'color: #3a6363'}
          = "#{@car.brand} #{@car.model} #{@car.year} in Dubai"
          - if @car.featured?
            %span.inline-flex.items-center.px-2.py-1.rounded-full.text-xs.font-bold.bg-yellow-100.text-yellow-800.ml-2.align-middle
              %i.fas.fa-star.mr-1
              Featured
          - if @car.with_driver?
            %span.inline-block.bg-blue-100.text-blue-700.text-sm.font-semibold.px-3.py-1.rounded-full.ml-2.align-middle With Driver
        .flex.items-center.space-x-4
          %button.p-2.border.rounded-lg.hover:bg-gray-50
            %i.far.fa-heart
          %button.p-2.border.rounded-lg.hover:bg-gray-50
            %i.fas.fa-share-alt

  / Main Content
  .max-w-7xl.mx-auto.px-4.sm:px-6.lg:px-8.py-8
    .grid.grid-cols-1.lg:grid-cols-3.gap-8

      / Left Column - Images (2/3 width)
      .lg:col-span-2
        / Main Image Gallery - Enhanced
        .bg-white.rounded-xl.shadow-sm.overflow-hidden.mb-6
          - if @car.images.attached? && @car.images.any?
            .relative
              / Main Image Container - Enhanced with larger size and fills width
              .swiper-container.relative{ style: 'min-height: 400px; max-height: 600px; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)' }
                .swiper-wrapper
                  - @car.images.each_with_index do |image, index|
                    .swiper-slide.flex.items-center.justify-center{ style: 'cursor: zoom-in', data: { index: index, url: url_for(image) } }
                      %img.w-full.h-auto.mx-auto{ src: url_for(image), alt: "#{@car.brand} #{@car.model} - Image #{index + 1}", style: 'filter: drop-shadow(0 10px 30px rgba(0,0,0,0.2)); max-height: 600px; object-fit: contain;' }

                / Navigation Buttons - Enhanced styling
                .swiper-button-prev.bg-white.bg-opacity-80.rounded-full.shadow-lg{ style: 'width: 50px; height: 50px; color: #3a6363' }
                .swiper-button-next.bg-white.bg-opacity-80.rounded-full.shadow-lg{ style: 'width: 50px; height: 50px; color: #3a6363' }
                .swiper-pagination{ style: 'bottom: 20px' }

              / Discount Badge - Top Left
              - if @car.has_discount?
                .absolute.top-6.left-6.z-20
                  .flex.items-center.gap-2.bg-gradient-to-r.from-red-500.to-red-600.text-white.px-4.py-2.rounded-full.shadow-lg
                    %i.fas.fa-tag.text-sm
                    %span.text-base.font-bold= "#{@car.discount_percentage}% OFF"

              / Image Counter - Enhanced styling
              .absolute.top-6.right-6.bg-black.bg-opacity-70.text-white.px-4.py-2.rounded-full.text-sm.font-semibold.shadow-lg
                %span.current-slide 1
                %span.mx-1 /
                %span.total-slides= @car.images.count

              / Zoom Icon Indicator
              .absolute.bottom-6.left-6.bg-black.bg-opacity-70.text-white.px-4.py-2.rounded-full.text-sm.font-semibold.shadow-lg.flex.items-center.gap-2
                %i.fas.fa-search-plus
                %span Click to zoom
              
              / Thumbnail Strip - Enhanced with better spacing and hover effects
              .p-6.bg-gradient-to-r.from-gray-50.to-gray-100
                .flex.gap-3.overflow-x-auto.p-2{ style: 'scrollbar-width: thin; scrollbar-color: #3a6363 #e5e7eb' }
                  - @car.images.each_with_index do |image, index|
                    %img.thumbnail-image.rounded-lg.cursor-pointer.border-3.transition-all.duration-300.hover:scale-105.hover:shadow-xl{ 
                      src: url_for(image), 
                      alt: "Thumbnail #{index + 1}",
                      "data-slide-index": index,
                      class: index == 0 ? "border-blue-600 shadow-lg" : "border-gray-300 hover:border-blue-400",
                      style: 'width: 100px; height: 70px; object-fit: cover;'
                    }
          - else
            .h-96.bg-gradient-to-br.from-gray-200.to-gray-300.flex.items-center.justify-center
              .text-center
                %i.fas.fa-car.text-gray-400.text-6xl.mb-4
                %p.text-gray-500.text-lg No images available

        / Rental Terms Card under gallery
        .bg-white.rounded-xl.shadow-sm.mb-6
          .px-6.py-4.border-b
            %h3.font-semibold.text-gray-900 Rental Terms
          .p-6
            .grid.grid-cols-1.sm:grid-cols-2.gap-x-10.gap-y-5.place-items-center.text-center
              .flex.items-center.justify-center.gap-3
                %i.fas.fa-tachometer-alt.text-xl.text-gray-700
                %span.text-gray-800 Mileage Policy
                %button.text-gray-400.hover:text-gray-600{ "data-policy" => "mileage" }
                  %i.fas.fa-info-circle
              .flex.items-center.justify-center.gap-3
                %i.fas.fa-gas-pump.text-xl.text-gray-700
                %span.text-gray-800 Fuel Policy
                %button.text-gray-400.hover:text-gray-600{ "data-policy" => "fuel" }
                  %i.fas.fa-info-circle
              .flex.items-center.justify-center.gap-3
                %i.fas.fa-file-alt.text-xl.text-gray-700
                %span.text-gray-800 Rental Policy
                %button.text-gray-400.hover:text-gray-600{ "data-policy" => "rental" }
                  %i.fas.fa-info-circle
              .flex.items-center.justify-center.gap-3
                %i.fas.fa-shield-alt.text-xl.text-gray-700
                %span.text-gray-800 Insurance Policy
                %button.text-gray-400.hover:text-gray-600{ "data-policy" => "insurance" }
                  %i.fas.fa-info-circle

        / Minimum Rental Duration Info
        .bg-white.rounded-xl.shadow-lg.mb-6
          .p-6
            .flex.flex-col.sm:flex-row.items-center.justify-center.gap-6.text-center
              .flex.items-center.gap-3
                %span.inline-flex.items-center.justify-center.w-6.h-6.rounded-full.bg-green-500.text-white
                  %i.fas.fa-check.text-xs
                %span.text-gray-800= "Minimum #{min_days} days rental"

      / Right Column - Pricing & Booking (1/3 width)
      .lg:col-span-1
        / Contact Info Card
        .bg-white.rounded-xl.shadow-sm.p-6.mb-6
          .flex.space-x-3
            = link_to admin_whatsapp_link("Hi, I'm interested in renting #{@car.brand} #{@car.model} #{@car.year}"), target: '_blank', class: 'flex-1 bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg text-sm font-semibold transition-all duration-200 shadow-md hover:shadow-lg text-center flex items-center justify-center gap-2' do
              %i.fab.fa-whatsapp.text-lg
              %span WhatsApp
            = link_to "tel:#{AppConstants::ADMIN_WHATSAPP_NUMBER}", class: 'flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 px-4 rounded-lg text-sm font-semibold transition-all duration-200 shadow-md hover:shadow-lg text-center flex items-center justify-center gap-2' do
              %i.fas.fa-phone.text-lg
              %span Call

        / Pricing Card - Three-tier selector
        .bg-white.rounded-xl.shadow-sm.p-6.mb-6{ "data-controller" => "pricing-selector" }
          .grid.grid-cols-1.sm:grid-cols-3.gap-3.mb-4
            - daily_price = @car.respond_to?(:daily_price) && @car.daily_price || 0
            - weekly_price = @car.respond_to?(:weekly_price) && @car.weekly_price || 0
            - monthly_price = @car.respond_to?(:monthly_price) && @car.monthly_price || 0
            - daily_mileage = @car.respond_to?(:daily_mileage) && @car.daily_mileage || @car.try(:daily_milleage) || 200
            - weekly_mileage = @car.respond_to?(:weekly_mileage) && @car.weekly_mileage || 1400
            - monthly_mileage = @car.respond_to?(:monthly_mileage) && @car.monthly_mileage || 6000
            - extra_charge = @car.respond_to?(:additional_mileage_charge) && @car.additional_mileage_charge || 1

            / Daily Card
            .cursor-pointer.border.rounded-xl.p-4.text-center.transition.shadow-sm.hover:shadow{
              "data-action" => "click->pricing-selector#select",
              "data-pricing-selector-target" => "card",
              "data-price" => daily_price,
              "data-period" => "daily",
              "data-mileage" => daily_mileage
            }
              %div.font-medium.uppercase.text-gray-500.mb-1 Daily
              - if @car.has_discount?
                %div.text-xs.text-gray-400.line-through AED #{daily_price}
                %div.font-bold{style: 'color: #3a6363'} AED
                %div.font-extrabold.text-red-600= @car.discounted_price(daily_price).round(2)
              - else
                %div.font-bold{style: 'color: #3a6363'} AED
                %div.font-extrabold{style: 'color: #3a6363'}= daily_price
              %div.text-xs.text-gray-500.mt-1 /day
              %div.mt-2.text-xs.text-gray-600 Includes
              %div.text-sm.font-medium= "#{daily_mileage} km"

            / Weekly Card
            .cursor-pointer.border.rounded-xl.p-4.text-center.transition.shadow-sm.hover:shadow{
              "data-action" => "click->pricing-selector#select",
              "data-pricing-selector-target" => "card",
              "data-price" => weekly_price,
              "data-period" => "weekly",
              "data-mileage" => weekly_mileage
            }
              %div.font-medium.uppercase.text-gray-500.mb-1 Weekly
              - if @car.has_discount?
                %div.text-xs.text-gray-400.line-through AED #{weekly_price}
                %div.font-bold{style: 'color: #3a6363'} AED
                %div.font-extrabold.text-red-600= @car.discounted_price(weekly_price).round(2)
              - else
                %div.font-bold{style: 'color: #3a6363'} AED
                %div.font-extrabold{style: 'color: #3a6363'}= weekly_price
              %div.text-xs.text-gray-500.mt-1 /week
              %div.mt-2.text-xs.text-gray-600 Includes
              %div.text-sm.font-medium= "#{weekly_mileage} km"

            / Monthly Card
            .cursor-pointer.border.rounded-xl.p-4.text-center.transition.shadow-sm.hover:shadow{
              "data-action" => "click->pricing-selector#select",
              "data-pricing-selector-target" => "card",
              "data-price" => monthly_price,
              "data-period" => "monthly",
              "data-mileage" => monthly_mileage
            }
              %div.font-medium.uppercase.text-gray-500.mb-1 Monthly
              - if @car.has_discount?
                %div.text-xs.text-gray-400.line-through AED #{monthly_price}
                %div.font-bold{style: 'color: #3a6363'} AED
                %div.font-extrabold.text-red-600= @car.discounted_price(monthly_price).round(2)
              - else
                %div.font-bold{style: 'color: #3a6363'} AED
                %div.font-extrabold{style: 'color: #3a6363'}= monthly_price
              %div.text-xs.text-gray-500.mt-1 /month
              %div.mt-2.text-xs.text-gray-600 Includes
              %div.text-sm.font-medium= "#{monthly_mileage} km"

          / Mileage and charge info
          .space-y-3.text-sm
            .flex.justify-between
              %span Additional mileage charge
              %span{ id: "additionalMileageText", "data-pricing-selector-target" => "additionalCharge" }= "AED #{extra_charge} /km"

          / Hidden inputs for booking submission
          = hidden_field_tag :selected_period, "daily", id: "selectedPeriodInput", "data-pricing-selector-target" => "selectedPeriod"
          = hidden_field_tag :selected_price, daily_price, id: "selectedPriceInput", "data-pricing-selector-target" => "selectedPrice"
          = hidden_field_tag :selected_mileage_limit, daily_mileage, id: "selectedMileageInput", "data-pricing-selector-target" => "selectedMileage"

          .border-t.pt-4.mt-4
            %button.w-full.py-3.px-4.rounded-lg.text-white.font-semibold{"data-bs-toggle" => "modal", "data-bs-target" => "#bookingModal", style: 'background-color: #3a6363'}
              Book Now

  / Car Overview Section
  .max-w-7xl.mx-auto.px-4.sm:px-6.lg:px-8.pb-8
    .bg-white.rounded-xl.shadow-sm.p-8
      %h2.text-2xl.font-bold.mb-6{style: 'color: #2d4f4f'} CAR OVERVIEW
      
      .grid.grid-cols-2.md:grid-cols-3.lg:grid-cols-4.gap-6
        .flex.items-center.space-x-3
          %i.fas.fa-car.text-gray-400.w-5
          .div
            %span.text-sm.text-gray-500 Body Type
            %p.font-medium= @car.category || 'Sedan'
        
        .flex.items-center.space-x-3
          %i.fas.fa-calendar.text-gray-400.w-5
          .div
            %span.text-sm.text-gray-500 Model
            %p.font-medium= @car.year || '2021'
        
        .flex.items-center.space-x-3
          %i.fas.fa-palette.text-gray-400.w-5
          .div
            %span.text-sm.text-gray-500 Colour
            %p.font-medium= @car.color || 'Black'
        
        .flex.items-center.space-x-3
          %i.fas.fa-gas-pump.text-gray-400.w-5
          .div
            %span.text-sm.text-gray-500 Fuel
            %p.font-medium= @car.fuel_type || 'Petrol'
        
        .flex.items-center.space-x-3
          %i.fas.fa-cogs.text-gray-400.w-5
          .div
            %span.text-sm.text-gray-500 Transmission
            %p.font-medium= @car.transmission || 'Auto'
        
        .flex.items-center.space-x-3
          %i.fas.fa-users.text-gray-400.w-5
          .div
            %span.text-sm.text-gray-500 Seating Capacity
            %p.font-medium= "#{@car.seats || 5} passengers"
        
        .flex.items-center.space-x-3
          %i.fas.fa-engine.text-gray-400.w-5
          .div
            %span.text-sm.text-gray-500 Engine CC
            %p.font-medium= @car.engine_size || '2.0L'

        - if @car.with_driver?
          .flex.items-center.space-x-3
            %i.fas.fa-user-tie.text-gray-400.w-5
            .div
              %span.text-sm.text-gray-500 Service Type
              %p.font-medium.text-blue-600 With Driver Available

  / Features & Specs Section
  .max-w-7xl.mx-auto.px-4.sm:px-6.lg:px-8.pb-8
    .bg-white.rounded-xl.shadow-sm.p-8
      %h2.text-2xl.font-bold.mb-6{style: 'color: #2d4f4f'} FEATURES & SPECS
      
      - if @car.features.any?
        .relative
          #featuresGrid.grid.grid-cols-1.sm:grid-cols-2.md:grid-cols-3.lg:grid-cols-4.gap-4
            - if @car.with_driver?
              .flex.items-center.feature-item.bg-blue-50.p-2.rounded-lg.border.border-blue-100{class: '', 'data-index': -1}
                %i.fas.fa-user-tie.mr-3.text-blue-500
                %span.text-gray-700.font-medium With Driver Service
                %span.ml-1.text-xs.text-blue-600 â­

            - @car.features.each_with_index do |feature, index|
              .flex.items-center.feature-item{class: index >= 12 ? 'hidden' : '', 'data-index': index}
                %i.fas.fa-check-circle.mr-3{class: feature.common ? 'text-green-500' : 'text-purple-500'}
                %span.text-gray-700
                  = feature.name
                  - unless feature.common
                    %span.ml-1.text-xs.text-purple-600 â­
          
          - if @car.features.count > 12
            .mt-6.text-center
              %button#showMoreFeaturesBtn.px-6.py-3.text-white.rounded-lg.font-semibold.transition-all.duration-200.shadow-md.hover:shadow-lg.flex.items-center.justify-center.mx-auto.gap-2{style: 'background-color: #3a6363'}
                %span#btnText Show More Features
                %i.fas.fa-chevron-down#btnIcon
      - else
        .text-center.py-8.text-gray-500
          %i.fas.fa-info-circle.text-3xl.mb-3
          %p No features available for this vehicle
  
  / Required Document Section
  .max-w-7xl.mx-auto.px-4.sm:px-6.lg:px-8.pb-8
    .bg-white.rounded-2xl.shadow-lg.p-8

      / Required Documents Section
      .mb-8
        .text-xl.font-bold.text-gray-800.mb-4 âœ… Required Documents
        %ul.text-gray-700.text-left.max-w-2xl.mx-10.list-disc.pl-6.space-y-2
          %li
            %strong Tourists / Non-Residents:
            | Passport copy, home country license, International Driving Permit (if required), Visa Copy.
          %li
            %strong Residents:
            | Emirates ID, UAE driving license.
          %li
            %strong GCC Nationals:
            | GCC ID or Passport, GCC driving license.

      / Before Delivery Section
      .mb-8
        .text-xl.font-bold.text-gray-800.mb-4 âœ… Before Delivery
        %ul.text-gray-700.text-left.max-w-2xl.mx-10.list-disc.pl-6.space-y-2
          %li Customers must present the receipt received during booking with Wheelsonrent at the time of car collection.
          %li Collect payment receipt.
          %li Collect a copy of the rental agreement.

      / Note Section
      .mb-8
        .text-xl.font-bold.text-gray-800.mb-4 âš ï¸ Note
        %ul.text-gray-700.text-left.max-w-2xl.mx-10.list-disc.pl-6.space-y-2
          %li Wheelsonrent platform only displays cars and manages reservations.
          %li Wheelsonrent bears no responsibility for rental payments made between the customer and the car rental company.
      
  / Recommended Cars Section
  - if @recommended_cars&.any?
    .max-w-7xl.mx-auto.px-4.sm:px-6.lg:px-8.pb-8
      .bg-white.rounded-xl.shadow-sm.p-8
        %h2.text-2xl.font-bold.mb-6{style: 'color: #2d4f4f'} RECOMMENDED CAR RENTALS
        .grid.grid-cols-1.md:grid-cols-2.lg:grid-cols-4.gap-6
          - @recommended_cars.each do |car|
            = link_to car_path(car), class: 'block bg-white border rounded-xl overflow-hidden hover:shadow-md transition-shadow' do
              - if car.images.attached? && car.images.any?
                %img.w-full.h-32.object-cover{ src: url_for(car.images.first), alt: "#{car.brand} #{car.model}" }
              - else
                .w-full.h-32.bg-gray-200.flex.items-center.justify-center
                  %i.fas.fa-car.text-gray-400.text-2xl
              .p-4
                %h3.font-semibold.text-sm.mb-1= "#{car.brand} #{car.model}"
                .text-xs.text-gray-500.mb-2= car.year
                .flex.justify-between.items-center
                  .text-sm.font-bold{style: 'color: #3a6363'}
                    = car.daily_price ? "AED #{car.daily_price}" : 'AED 0'
                  .text-xs.text-gray-400 /day

/ FOOTER
- content_for :footer do
  %footer.bg-gray-900.text-white
    .max-w-7xl.mx-auto.px-4.sm:px-6.lg:px-8.py-12
      .grid.grid-cols-1.md:grid-cols-4.gap-8
        .space-y-4
          .flex.items-center
            %img{src: asset_path('new_logo.png'), alt: 'WheelsOnRent', class: 'w-10 h-10'}
            %span.text-xl.font-extrabold.ml-2= (@company && @company[:name]) || 'WheelsOnRent'
          %p.text-gray-300= (@company && @company[:blurb]) || 'Enjoy great offers on budget and luxury rentals, chauffeur services, and limousines with WheelsOnRent. Headquartered in Dubai, serving all of the UAE'
          .mt-6
            %h4.text-white.font-semibold.mb-4 Follow us on
            .flex.gap-3
              = link_to AppConstants::FACEBOOK, target: '_blank', rel: 'noopener noreferrer', class: 'w-10 h-10 bg-gray-800 rounded-full flex items-center justify-center hover:bg-blue-600 transition-all duration-300 hover:scale-110', title: 'Facebook' do
                %svg.w-5.h-5{fill: 'currentColor', viewBox: '0 0 24 24'}
                  %path{d: 'M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z'}
              
              = link_to AppConstants::INSTAGRAM, target: '_blank', rel: 'noopener noreferrer', class: 'w-10 h-10 bg-gray-800 rounded-full flex items-center justify-center hover:bg-pink-600 transition-all duration-300 hover:scale-110', title: 'Instagram' do
                %svg.w-5.h-5{fill: 'currentColor', viewBox: '0 0 24 24'}
                  %path{d: 'M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z'}
              
              = link_to AppConstants::TWITTER, target: '_blank', rel: 'noopener noreferrer', class: 'w-10 h-10 bg-gray-800 rounded-full flex items-center justify-center hover:bg-sky-500 transition-all duration-300 hover:scale-110', title: 'Twitter' do
                %svg.w-5.h-5{fill: 'currentColor', viewBox: '0 0 24 24'}
                  %path{d: 'M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z'}
              
              = link_to AppConstants::YOUTUBE, target: '_blank', rel: 'noopener noreferrer', class: 'w-10 h-10 bg-gray-800 rounded-full flex items-center justify-center hover:bg-red-600 transition-all duration-300 hover:scale-110', title: 'YouTube' do
                %svg.w-5.h-5{fill: 'currentColor', viewBox: '0 0 24 24'}
                  %path{d: 'M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z'}
              
              = link_to AppConstants::TIKTOK, target: '_blank', rel: 'noopener noreferrer', class: 'w-10 h-10 bg-gray-800 rounded-full flex items-center justify-center hover:bg-black transition-all duration-300 hover:scale-110', title: 'TikTok' do
                %img{src: asset_path('tiktok-icon.png'), alt: 'TikTok', class: 'w-6 h-6 invert'}
        .space-y-4
          %h4.text-white.font-semibold Quick Links
          %ul.space-y-2
            - default_footer_links = [{label:'Browse Cars',href: cars_path}, {label:'List Your Car',href: new_vendor_request_path}, {label:'Blog',href: blogs_path}]
            - (@footer_links || default_footer_links).each do |l|
              %li= link_to l[:label], l[:href], class: 'text-gray-300 hover:text-white transition'
        .space-y-4
          %h4.text-white.font-semibold Support
          %ul.space-y-2
            - default_support_links = [{label:'Terms & Conditions',href: terms_of_use_path}]
            - (@support_links || default_support_links).each do |l|
              %li= link_to l[:label], l[:href], class: 'text-gray-300 hover:text-white transition'
        .space-y-4
          %h4.text-white.font-semibold Contact Info
          - default_contact = {phone: '+971506336408', email: 'booking@wheelsonrent.ae', address: 'Building A1, Dubai Digital Park, Dubai Silicon Oasis, Dubai'}
          - c = (@contact || default_contact)
          %div.text-gray-300
            %p.py-2
              %svg.w-5.h-5.inline.text-green-500.mr-2{fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24', 'stroke-width': '2'}
                %path{d: 'M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z'}
              = link_to c[:phone], "tel:#{c[:phone]}", class: 'text-gray-300 hover:text-white transition-colors'
            %p.py-2
              ðŸ“§
              = link_to c[:email], "mailto:#{c[:email]}", class: 'text-gray-300 hover:text-white transition-colors'
            %p.py-2= "ðŸ“ #{c[:address]}"

            .space-y-4
              %h4.text-white.font-semibold Flexible ways to pay your partner directly
              .flex.gap-4.flex-wrap
                %img{src: asset_path('visa.png'), alt: 'Visa', class: 'h-6'}
                %img{src: asset_path('mastercard.png'), alt: 'Mastercard', class: 'h-6'}
                %img{src: asset_path('unionpay.png'), alt: 'UnionPay', class: 'h-6'}
                %img{src: asset_path('apple-pay.png'), alt: 'Apple Pay', class: 'h-6'}
                %img{src: asset_path('google-pay.png'), alt: 'Google Pay', class: 'h-6'}
      .border-t.border-gray-800.mt-8.pt-8.text-center.text-gray-400
        %p &copy; #{Time.current.year} WheelsOnRent. All rights reserved.

/ Booking Modal
#bookingModal.modal.fade{"aria-hidden" => "true", "aria-labelledby" => "bookingModalLabel", tabindex: "-1", "data-controller" => "modal"}
  .modal-dialog.modal-dialog-centered.mt-16
    .modal-content.rounded-2xl.shadow-xl.border{style: 'border-color: #cfe5e5'}
      .modal-header.flex.items-center.justify-between.px-6.py-4
        %h5#bookingModalLabel.modal-title.text-xl.font-bold{style: 'color: #2d4f4f'} Book This Car
        %button.text-gray-400.hover:text-gray-600.transition{"aria-label" => "Close", "data-bs-dismiss" => "modal", type: "button"}
          %i.fas.fa-times

      .modal-body.bg-white.px-6.py-4
        .mb-4
          %label.block.text-sm.font-medium.mb-1{style: 'color: #2d4f4f'} Pickup Date
          = text_field_tag :start_date, nil, required: true, class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 flatpickr", autocomplete: "off", id: "startDateInput", style: "--tw-ring-color:#3a6363"

        .mb-4
          %label.block.text-sm.font-medium.mb-1{style: 'color: #2d4f4f'} Return Date
          = text_field_tag :end_date, nil, required: true, class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 flatpickr", autocomplete: "off", id: "endDateInput", style: "--tw-ring-color:#3a6363"

        .mb-4
          %label.block.text-sm.font-medium.mb-2{style: 'color: #2d4f4f'} Service Option (Optional)
          %p.text-xs.text-gray-500.mb-2.italic Leave unselected if you don't need pickup or delivery service
          .grid.grid-cols-2.gap-3
            %label.cursor-pointer.border-2.rounded-lg.p-3.transition-all.hover:border-opacity-70{ class: "delivery-option-card", "data-option" => "pickup", style: "border-color: #ccc;" }
              .flex.items-center
                %input.mr-3{ type: "radio", name: "delivery_option", value: "pickup", id: "pickupOption", style: "accent-color: #3a6363;" }
                .flex-1
                  .flex.items-center.gap-2.mb-1
                    %i.fas.fa-car{style: "color: #3a6363;"}
                    %span.font-semibold.text-gray-800 Pickup
                  %p.text-xs.text-gray-600 Pickup from your location
                  %p.text-xs.font-semibold{style: "color: #3a6363;"} +AED 50

            %label.cursor-pointer.border-2.rounded-lg.p-3.transition-all.hover:border-opacity-70{ class: "delivery-option-card", "data-option" => "delivery", style: "border-color: #ccc;" }
              .flex.items-center
                %input.mr-3{ type: "radio", name: "delivery_option", value: "delivery", id: "deliveryOption", style: "accent-color: #3a6363;" }
                .flex-1
                  .flex.items-center.gap-2.mb-1
                    %i.fas.fa-shipping-fast{style: "color: #3a6363;"}
                    %span.font-semibold.text-gray-800 Delivery
                  %p.text-xs.text-gray-600 Car delivered to you
                  %p.text-xs.font-semibold{style: "color: #3a6363;"} +AED 50

      .modal-footer.flex.justify-end.gap-4.px-6.py-4
        %button.bg-gray-200.text-gray-700.font-semibold.px-5.py-2.rounded-lg.hover:bg-gray-300.transition{ "data-bs-dismiss" => "modal", type: "button" } Close
        - if user_signed_in?
          %button.text-white.font-semibold.px-6.py-2.rounded-lg.shadow-md.transition.hover:shadow-lg{ type: "button", id: "createBookingBtn", style: "background-color: #3a6363; cursor: pointer;" } Create Booking
        - else
          %button.text-white.font-semibold.px-6.py-2.rounded-lg.shadow-md.transition.hover:shadow-lg{ type: "button", id: "continueToLoginLink", disabled: true, style: "pointer-events: none; opacity: 0.5; background-color: #3a6363; cursor: not-allowed;" } Continue to Sign In

/ Right-side Drawer for policy info
#policyDrawer.fixed.top-0.right-0.h-full.w-96.bg-white.shadow-2xl.transform.translate-x-full.transition-transform.duration-300.z-50{ 'aria-hidden' => 'true' }
  .flex.items-center.justify-between.px-5.py-4.border-b
    %h5#policyDrawerTitle.text-lg.font-bold{style: 'color:#2d4f4f'} Policy Details
    %button#closePolicyDrawer.text-gray-400.hover:text-gray-600{ type: 'button', 'aria-label' => 'Close' }
      %i.fas.fa-times
  .p-5.overflow-y-auto.h-full
    #policyDrawerContent.text-gray-700
      / Content populated by JavaScript

/ Lightbox Modal for Full-Screen Image View
#lightboxModal.fixed.inset-0.bg-black.bg-opacity-95.z-50.hidden.flex.items-center.justify-center{ style: 'backdrop-filter: blur(10px)' }
  / Close Button
  %button#closeLightbox.absolute.top-6.right-6.text-white.text-4xl.hover:text-gray-300.transition.z-10{ type: 'button' }
    %i.fas.fa-times
  
  / Navigation Buttons
  %button#lightboxPrev.absolute.left-6.text-white.text-5xl.hover:text-gray-300.transition.z-10{ type: 'button', style: 'top: 50%; transform: translateY(-50%)' }
    %i.fas.fa-chevron-left
  %button#lightboxNext.absolute.right-6.text-white.text-5xl.hover:text-gray-300.transition.z-10{ type: 'button', style: 'top: 50%; transform: translateY(-50%)' }
    %i.fas.fa-chevron-right
  
  / Main Image
  .relative.w-full.h-full.flex.items-center.justify-center.p-8
    %img#lightboxImage.max-h-full.max-w-full.object-contain{ src: '', alt: 'Full size image' }
  
  / Image Counter
  .absolute.bottom-6.text-white.px-6.py-3.rounded-full.text-lg.font-semibold{ style: 'left: 50%; transform: translateX(-50%); background-color: rgba(255, 255, 255, 0.2)' }
    %span#lightboxCounter 1 / 1

:javascript
  // Flag to prevent multiple initializations
  window.carShowPageInitialized = window.carShowPageInitialized || false;

  // Main initialization function
  function initializeCarShowPage() {
    // Only initialize once per page load
    if (window.carShowPageInitialized) {
      return;
    }
    window.carShowPageInitialized = true;

    // Booking Modal Logic
    const continueBtn = document.getElementById("continueToLoginLink");
    let createBookingBtn = document.getElementById("createBookingBtn");
    const startInput = document.getElementById("startDateInput");
    const endInput = document.getElementById("endDateInput");

    // Function to check if both dates are selected and update button states
    function updateButtonStates() {
      // Get both buttons fresh each time
      const createBtn = document.getElementById("createBookingBtn");
      const continueBtn = document.getElementById("continueToLoginLink");

      if (startInput && endInput) {
        const startValue = startInput.value.trim();
        const endValue = endInput.value.trim();

        if (startValue && endValue) {
          // Both dates selected - ENABLE buttons
          [createBtn, continueBtn].forEach(btn => {
            if (btn) {
              btn.removeAttribute('disabled');
              btn.style.pointerEvents = 'auto';
              btn.style.opacity = '1';
              btn.style.cursor = 'pointer';
            }
          });
        } else {
          // Missing a date - DISABLE buttons
          [createBtn, continueBtn].forEach(btn => {
            if (btn) {
              btn.setAttribute('disabled', 'disabled');
              btn.style.pointerEvents = 'none';
              btn.style.opacity = '0.5';
              btn.style.cursor = 'not-allowed';
            }
          });
        }
      }
    }

    // Attach listeners to both date inputs
    if (startInput) {
      startInput.addEventListener('change', updateButtonStates);
      startInput.addEventListener('input', updateButtonStates);
      startInput.addEventListener('blur', updateButtonStates);
    }

    if (endInput) {
      endInput.addEventListener('change', updateButtonStates);
      endInput.addEventListener('input', updateButtonStates);
      endInput.addEventListener('blur', updateButtonStates);
    }

    // Initial state - buttons should be disabled
    updateButtonStates();

    // Delivery Option Cards Selection
    const deliveryOptionCards = document.querySelectorAll('.delivery-option-card');
    const deliveryRadios = document.querySelectorAll('input[name="delivery_option"]');

    deliveryOptionCards.forEach(card => {
      card.addEventListener('click', function() {
        const option = this.getAttribute('data-option');
        const radio = document.getElementById(option + 'Option');
        if (radio) {
          radio.checked = true;
          // Update card styling
          deliveryOptionCards.forEach(c => {
            c.style.borderColor = '#ccc';
            c.style.backgroundColor = 'transparent';
          });
          this.style.borderColor = '#3a6363';
          this.style.backgroundColor = '#e8f0f0';
        }
      });
    });

    // Continue to Login button
    if (continueBtn) {
      continueBtn.addEventListener("click", function (e) {
        if (!startInput?.value || !endInput?.value) {
          e.preventDefault();
          alert("Please select both start and end dates.");
          return;
        }
        e.preventDefault();
        const carId = "#{@car.id}";
        const startDate = startInput.value;
        const endDate = endInput.value;
        const selectedPeriod = document.getElementById("selectedPeriodInput")?.value || "daily";
        const selectedPrice = document.getElementById("selectedPriceInput")?.value || "0";
        const selectedMileage = document.getElementById("selectedMileageInput")?.value || "0";
        const deliveryOption = document.querySelector('input[name="delivery_option"]:checked')?.value || "";
        const queryParams = new URLSearchParams({
          car_id: carId,
          start_date: startDate,
          end_date: endDate,
          selected_period: selectedPeriod,
          selected_price: selectedPrice,
          selected_mileage_limit: selectedMileage,
          delivery_option: deliveryOption
        });
        window.location.href = "/users/sign_in?" + queryParams.toString();
      });
    }

    // Create Booking
    if (createBookingBtn) {
      // Clone the button to remove old listeners
      const newCreateBookingBtn = createBookingBtn.cloneNode(true);
      createBookingBtn.parentNode.replaceChild(newCreateBookingBtn, createBookingBtn);
      
      // Update the reference to point to the new button
      createBookingBtn = newCreateBookingBtn;

      console.log('Button cloned and ready');

      newCreateBookingBtn.addEventListener("click", function (e) {
        e.preventDefault();

        if (!startInput?.value || !endInput?.value) {
          alert("Please select both start and end dates.");
          return;
        }

        // Disable button to prevent multiple clicks
        newCreateBookingBtn.disabled = true;
        newCreateBookingBtn.style.pointerEvents = "none !important";
        newCreateBookingBtn.style.opacity = "0.5 !important";
        newCreateBookingBtn.style.cursor = "not-allowed";
        const originalText = newCreateBookingBtn.textContent;
        newCreateBookingBtn.textContent = "Creating...";

        const formData = new FormData();
        formData.append('booking[car_id]', "#{@car.id}");
        formData.append('booking[start_date]', startInput.value);
        formData.append('booking[end_date]', endInput.value);
        formData.append('booking[selected_period]', document.getElementById("selectedPeriodInput")?.value || 'daily');
        formData.append('booking[selected_price]', document.getElementById("selectedPriceInput")?.value || '0');
        formData.append('booking[selected_mileage_limit]', document.getElementById("selectedMileageInput")?.value || '0');
        const deliveryOption = document.querySelector('input[name="delivery_option"]:checked')?.value || "";
        if (deliveryOption) {
          formData.append('booking[delivery_option]', deliveryOption);
        }

        fetch('/bookings', {
          method: 'POST',
          body: formData,
          headers: {
            'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
          }
        })
        .then(response => {
          if (response.redirected) {
            window.location.href = response.url;
          } else if (response.ok) {
            return response.text();
          } else {
            throw new Error('Booking creation failed');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('There was an error creating your booking. Please check your dates and try again.');
          // Re-enable button on error
          newCreateBookingBtn.disabled = false;
          newCreateBookingBtn.style.pointerEvents = "auto !important";
          newCreateBookingBtn.style.opacity = "1 !important";
          newCreateBookingBtn.style.cursor = "pointer";
          newCreateBookingBtn.textContent = originalText;
        });
      });
    }

    // Policy Drawer Logic
    const insurancePolicy = #{@car.insurance_policy.present? ? @car.insurance_policy.to_json : '"No Insurance Provided"'.html_safe};
    
    const policyContent = {
      mileage: {
        title: 'Mileage Policy',
        content: 'Most rentals come with a daily mileage limit (200-250 km per day). Exceeding this limit will result in additional charges of AED 0.50 per extra kilometer. Some rental companies also offer unlimited mileage or extra mileage packages.'
      },
      fuel: {
        title: 'Fuel Policy',
        content: 'The vehicle will be provided with a full tank of fuel. You are required to return the vehicle with the same fuel level. If returned with less fuel, you will be charged for refueling at current market rates plus a service fee.'
      },
      rental: {
        title: 'Rental Policy',
        content: "Renters must be at least 21 years old. UAE residents need a valid UAE driving license, and tourists must provide an International Driving Permit. Any traffic fines incurred during the rental period are the renter's responsibility. Vehicles should be returned to the original pickup location unless alternative arrangements have been approved in advance."
      },
      insurance: {
        title: 'Insurance Policy',
        content: insurancePolicy
      }
    };

    function openPolicyDrawer(title, content) {
      const drawer = document.getElementById('policyDrawer');
      const titleEl = document.getElementById('policyDrawerTitle');
      const contentEl = document.getElementById('policyDrawerContent');
      if (!drawer || !titleEl || !contentEl) return;
      titleEl.textContent = title;
      contentEl.innerHTML = '<p>' + content + '</p>';
      drawer.setAttribute('aria-hidden', 'false');
      drawer.classList.remove('translate-x-full');
    }

    function closePolicyDrawer() {
      const drawer = document.getElementById('policyDrawer');
      if (!drawer) return;
      drawer.setAttribute('aria-hidden', 'true');
      drawer.classList.add('translate-x-full');
    }

    const closeBtn = document.getElementById('closePolicyDrawer');
    if (closeBtn) {
      closeBtn.addEventListener('click', closePolicyDrawer);
    }

    document.querySelectorAll('[data-policy]').forEach(button => {
      button.addEventListener('click', function(e) {
        const policyType = this.getAttribute('data-policy');
        const policy = policyContent[policyType];
        if (!policy) return;
        e.preventDefault();
        openPolicyDrawer(policy.title, policy.content);
      });
    });

    // Show More Features Logic
    const showMoreBtn = document.getElementById('showMoreFeaturesBtn');
    const btnText = document.getElementById('btnText');
    const btnIcon = document.getElementById('btnIcon');
    let isExpanded = false;
    
    if (showMoreBtn) {
      showMoreBtn.addEventListener('click', function() {
        const allFeatures = document.querySelectorAll('.feature-item');
        
        if (!isExpanded) {
          allFeatures.forEach(function(feature) {
            feature.classList.remove('hidden');
          });
          btnText.textContent = 'Show Less Features';
          btnIcon.classList.remove('fa-chevron-down');
          btnIcon.classList.add('fa-chevron-up');
          isExpanded = true;
        } else {
          allFeatures.forEach(function(feature) {
            if (parseInt(feature.getAttribute('data-index')) >= 12) {
              feature.classList.add('hidden');
            }
          });
          btnText.textContent = 'Show More Features';
          btnIcon.classList.remove('fa-chevron-up');
          btnIcon.classList.add('fa-chevron-down');
          isExpanded = false;
          
          document.querySelector('#featuresGrid')?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
      });
    }

    // Enhanced Swiper initialization with Lightbox
    if (window.Swiper) {
      const existingSwiperContainer = document.querySelector('.swiper-container');
      if (existingSwiperContainer && existingSwiperContainer.swiper) {
        existingSwiperContainer.swiper.destroy(true, true);
      }

      const swiper = new Swiper('.swiper-container', {
        loop: true,
        navigation: {
          nextEl: '.swiper-button-next',
          prevEl: '.swiper-button-prev',
        },
        pagination: {
          el: '.swiper-pagination',
          clickable: true,
          dynamicBullets: true,
        },
        slidesPerView: 1,
        spaceBetween: 0,
        centeredSlides: true,
        speed: 600,
        effect: 'fade',
        fadeEffect: {
          crossFade: true
        },
        keyboard: {
          enabled: true,
        },
        on: {
          slideChange: function() {
            const currentSlide = document.querySelector('.current-slide');
            if (currentSlide) {
              currentSlide.textContent = this.realIndex + 1;
            }
            updateThumbnailActiveState(this.realIndex);
          }
        }
      });

      // Lightbox functionality
      const lightboxModal = document.getElementById('lightboxModal');
      const lightboxImage = document.getElementById('lightboxImage');
      const lightboxCounter = document.getElementById('lightboxCounter');
      const closeLightbox = document.getElementById('closeLightbox');
      const lightboxPrev = document.getElementById('lightboxPrev');
      const lightboxNext = document.getElementById('lightboxNext');
      
      let currentLightboxIndex = 0;
      const totalImages = document.querySelectorAll('.swiper-slide').length;

      document.querySelectorAll('.swiper-slide').forEach((slide, index) => {
        slide.addEventListener('click', function() {
          currentLightboxIndex = index;
          openLightbox(index);
        });
      });

      function openLightbox(index) {
        const slide = document.querySelectorAll('.swiper-slide')[index];
        const imageUrl = slide.getAttribute('data-url');
        
        if (lightboxImage && lightboxModal && imageUrl) {
          lightboxImage.src = imageUrl;
          lightboxCounter.textContent = `${index + 1} / ${totalImages}`;
          lightboxModal.classList.remove('hidden');
          document.body.style.overflow = 'hidden';
        }
      }

      function closeLightboxModal() {
        if (lightboxModal) {
          lightboxModal.classList.add('hidden');
          document.body.style.overflow = '';
        }
      }

      function navigateLightbox(direction) {
        currentLightboxIndex = direction === 'next' 
          ? (currentLightboxIndex + 1) % totalImages 
          : (currentLightboxIndex - 1 + totalImages) % totalImages;
        openLightbox(currentLightboxIndex);
      }

      if (closeLightbox) {
        closeLightbox.addEventListener('click', closeLightboxModal);
      }
      if (lightboxPrev) {
        lightboxPrev.addEventListener('click', () => navigateLightbox('prev'));
      }
      if (lightboxNext) {
        lightboxNext.addEventListener('click', () => navigateLightbox('next'));
      }

      document.addEventListener('keydown', function(e) {
        if (lightboxModal && !lightboxModal.classList.contains('hidden')) {
          if (e.key === 'Escape') closeLightboxModal();
          if (e.key === 'ArrowLeft') navigateLightbox('prev');
          if (e.key === 'ArrowRight') navigateLightbox('next');
        }
        if (e.key === 'Escape') closePolicyDrawer();
      });

      if (lightboxModal) {
        lightboxModal.addEventListener('click', function(e) {
          if (e.target === lightboxModal) closeLightboxModal();
        });
      }

      function updateThumbnailActiveState(activeIndex) {
        const thumbnails = document.querySelectorAll('.thumbnail-image');
        thumbnails.forEach((thumb, index) => {
          if (index === activeIndex) {
            thumb.classList.remove('border-gray-300');
            thumb.classList.add('border-blue-600', 'shadow-lg', 'scale-105');
          } else {
            thumb.classList.add('border-gray-300');
            thumb.classList.remove('border-blue-600', 'shadow-lg', 'scale-105');
          }
        });

        const activeThumbnail = thumbnails[activeIndex];
        if (activeThumbnail) {
          activeThumbnail.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
        }
      }

      const thumbnails = document.querySelectorAll('.thumbnail-image');
      thumbnails.forEach((thumbnail) => {
        thumbnail.addEventListener('click', function() {
          const slideIndex = parseInt(this.getAttribute('data-slide-index'));
          swiper.slideToLoop(slideIndex);
          updateThumbnailActiveState(slideIndex);
        });
      });

      updateThumbnailActiveState(0);
    }
  }

  document.addEventListener('turbo:before-cache', function() {
    window.carShowPageInitialized = false;
  });

  document.addEventListener('DOMContentLoaded', initializeCarShowPage);
  document.addEventListener('turbo:load', initializeCarShowPage);
