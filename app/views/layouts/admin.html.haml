!!! 5
%html{ lang: "en" }
  %head
    %meta{ charset: "UTF-8" }
    %meta{ name: "viewport", content: "width=device-width, initial-scale=1.0" }
    = csrf_meta_tags
    %title Admin Dashboard
    %script{ src: "https://cdn.tailwindcss.com" }
    %link{ rel: "stylesheet", href: "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css", integrity: "sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==", crossorigin: "anonymous", referrerpolicy: "no-referrer" }
    %link{ rel: "stylesheet", href: "https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" }
    -# %style
      /* Custom styles for admin image sliders */
      .swiper-container {
        width: 100%;
        height: 100%;
      }
      
      .swiper-slide {
        text-align: center;
        font-size: 18px;
        background: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      
      .swiper-button-next,
      .swiper-button-prev {
        color: white;
        background: rgba(0, 0, 0, 0.5);
        width: 44px;
        height: 44px;
        border-radius: 50%;
        transition: all 0.3s ease;
      }
      
      .swiper-button-next:hover,
      .swiper-button-prev:hover {
        background: rgba(0, 0, 0, 0.8);
        transform: scale(1.1);
      }
      
      .swiper-pagination-bullet {
        background: white;
        opacity: 0.7;
      }
      
      .swiper-pagination-bullet-active {
        opacity: 1;
        background: white;
      }
      
      /* Uniform car card images */
      .car-image {
        transition: transform 0.3s ease;
      }
      
      .car-image:hover {
        transform: scale(1.05);
      }
      
      /* Image counter styles */
      .current-slide {
        font-weight: bold;
      }
  %body.bg-gray-50.min-h-screen
    .flex.min-h-screen
      / Mobile Overlay
      #sidebarOverlay.hidden.fixed.inset-0.bg-black.bg-opacity-50.z-30.md:hidden

      / Sidebar - Hidden on mobile, slides in when toggled
      #sidebar.fixed.md:fixed.w-64.text-white.flex.flex-col.py-8.px-4.h-screen.top-0.left-0.z-40.transform.-translate-x-full.md:translate-x-0.transition-transform.duration-300.ease-in-out{style: "background: linear-gradient(to bottom, #3A6363, #2d4d4d);"}
        .flex.items-center.mb-10
          %span.text-2xl.font-extrabold.tracking-wide.ml-2 WheelsOnRent
        %nav.flex-1.space-y-4.overflow-y-auto.pb-4
          - nav_links = [{name: 'Dashboard', path: admin_dashboard_index_path, icon: 'fas fa-tachometer-alt'},{name: 'Vehicles', path: '/admin/cars', icon: 'fas fa-car'},{name: 'Vendors', path: admin_vendors_path, icon: 'fas fa-store'},{name: 'Invited Vendors', path: admin_invited_vendors_path, icon: 'fas fa-user-plus'},{name: 'Vendor Join Requests', path: admin_vendor_requests_path, icon: 'fas fa-user-plus'},{name: 'Customers', path: '/admin/customers', icon: 'fas fa-users'},{name: 'Bookings', path: '/admin/bookings', icon: 'fas fa-calendar-check'},{name: 'Activities', path: admin_activities_path, icon: 'fas fa-chart-line'},{name: 'Analytics', path: admin_analytics_path, icon: 'fas fa-chart-bar'},{name: 'Car Features', path: admin_features_path, icon: 'fas fa-taxi'}]
          - if current_admin&.super_admin?
            - nav_links << {name: 'Admins', path: admins_path, icon: 'fas fa-user-shield'}
          - nav_links.each do |link|
            - active = request.path == link[:path]
            %a.flex.items-center.gap-3.py-2.5.px-4.rounded-lg.font-medium.transition{ href: link[:path], class: (active ? 'bg-white/20 text-white shadow' : 'hover:bg-white/10 hover:text-white') }
              %i{class: link[:icon]}
              = link[:name]
      / Main content
      .flex-1.flex.flex-col.md:ml-64
        %header.flex.items-center.justify-between.h-16.bg-white.shadow.px-4.md:px-6.sticky.top-0.z-20
          .flex.items-center.gap-3
            / Mobile Menu Button - Visible only on mobile
            %button#mobileMenuBtn.md:hidden.p-2.rounded-lg.focus:outline-none.transition-all.duration-200{style: "color: #3A6363; background-color: #e8f0f0;", onmouseover: "this.style.backgroundColor='#d1e0e0'; this.style.color='#2d4d4d'", onmouseout: "this.style.backgroundColor='#e8f0f0'; this.style.color='#3A6363'"}
              %i.fas.fa-bars.text-xl
            %span.text-lg.font-bold.md:hidden{style: "color: #3A6363;"} WheelsOnRent
          .relative
            %button#profileDropdownBtn.flex.items-center.focus:outline-none
              -# %img.w-8.h-8.rounded-full.mr-2{:alt => "Profile", :src => "https://randomuser.me/api/portraits/men/32.jpg"}/
              %span.hidden.md:block.font-medium.text-gray-700.text-lg
                = current_admin.display_name.titleize
              %svg.w-4.h-4.ml-1.text-gray-500{:fill => "none", :stroke => "currentColor", "stroke-width" => "2", :viewbox => "0 0 24 24"}
                %path{:d => "M19 9l-7 7-7-7", "stroke-linecap" => "round", "stroke-linejoin" => "round"}
            #profileDropdown.hidden.absolute.right-0.mt-2.w-40.bg-white.rounded.shadow-lg.py-2
              = link_to "Edit Profile", edit_admins_path, class: "block px-4 py-2 text-gray-700 hover:bg-gray-100"
              .border-t.my-1
              = button_to "Logout", destroy_admin_session_path, method: :delete, class: "block w-full text-left px-4 py-2 text-red-600 hover:bg-gray-100"
        / Main content area
        .flex-1.bg-gray-50
          .max-w-7xl.mx-auto
            = yield

    %script{ src: "https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js" }

:javascript
  (function() {
    function initializeAdminLayout() {
      console.log('ðŸ”§ Initializing admin layout...');

      // Profile dropdown toggle
      var profileBtn = document.getElementById('profileDropdownBtn');
      var profileMenu = document.getElementById('profileDropdown');
      if (profileBtn && profileMenu) {
        profileBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          profileMenu.classList.toggle('hidden');
        });
        document.addEventListener('click', function(e) {
          if (!profileBtn.contains(e.target) && !profileMenu.contains(e.target)) {
            profileMenu.classList.add('hidden');
          }
        });
      }

      // Mobile sidebar toggle
      var mobileMenuBtn = document.getElementById('mobileMenuBtn');
      var sidebar = document.getElementById('sidebar');
      var sidebarOverlay = document.getElementById('sidebarOverlay');

      if (mobileMenuBtn && sidebar && sidebarOverlay) {
        console.log('âœ… Mobile menu elements found');

        // Open sidebar
        mobileMenuBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          console.log('ðŸ”“ Opening sidebar');
          sidebar.classList.remove('-translate-x-full');
          sidebar.classList.add('translate-x-0');
          sidebarOverlay.classList.remove('hidden');
          document.body.style.overflow = 'hidden';
        });

        // Close sidebar when clicking overlay
        sidebarOverlay.addEventListener('click', function() {
          console.log('ðŸ”’ Closing sidebar');
          sidebar.classList.add('-translate-x-full');
          sidebar.classList.remove('translate-x-0');
          sidebarOverlay.classList.add('hidden');
          document.body.style.overflow = 'auto';
        });

        // Close sidebar on navigation (mobile only)
        var sidebarLinks = sidebar.querySelectorAll('a');
        sidebarLinks.forEach(function(link) {
          link.addEventListener('click', function() {
            // Only close on mobile
            if (window.innerWidth < 768) {
              sidebar.classList.add('-translate-x-full');
              sidebar.classList.remove('translate-x-0');
              sidebarOverlay.classList.add('hidden');
              document.body.style.overflow = 'auto';
            }
          });
        });

        // Close sidebar on escape key
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape' && !sidebar.classList.contains('-translate-x-full')) {
            sidebar.classList.add('-translate-x-full');
            sidebar.classList.remove('translate-x-0');
            sidebarOverlay.classList.add('hidden');
            document.body.style.overflow = 'auto';
          }
        });

        console.log('âœ… Mobile sidebar initialized');
      } else {
        console.log('âš ï¸ Some mobile menu elements not found');
      }
    }

    // Initialize on DOM ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeAdminLayout);
    } else {
      initializeAdminLayout();
    }

    // Reinitialize on Turbo navigation
    document.addEventListener('turbo:load', initializeAdminLayout);

    console.log('âœ… Admin layout script ready');
  })();
