.container.mx-auto.px-4.py-16
  .max-w-4xl.mx-auto
    .bg-white.shadow-lg.rounded-xl.overflow-hidden
      / Header
      .bg-gradient-to-r.from-blue-600.to-blue-700.px-8.py-6.text-white
        .flex.justify-between.items-start
          %div
            %h1.text-2xl.font-bold Invoice Details
            %p.text-blue-100.mt-1
              Invoice #
              %span.font-mono= @invoice.id
          / Status Badge
          - case @invoice.payment_status
          - when 'paid'
            %span.inline-flex.items-center.px-4.py-2.rounded-full.text-sm.font-semibold.bg-green-500.text-white
              %i.fas.fa-check-circle.mr-2
              Paid
          - when 'pending'
            %span.inline-flex.items-center.px-4.py-2.rounded-full.text-sm.font-semibold.bg-yellow-500.text-white
              %i.fas.fa-clock.mr-2
              Pending Payment
          - when 'overdue'
            %span.inline-flex.items-center.px-4.py-2.rounded-full.text-sm.font-semibold.bg-red-500.text-white
              %i.fas.fa-exclamation-circle.mr-2
              Overdue
          - when 'cancelled'
            %span.inline-flex.items-center.px-4.py-2.rounded-full.text-sm.font-semibold.bg-gray-500.text-white
              %i.fas.fa-ban.mr-2
              Cancelled

      / Content
      .p-8
        / Invoice Details
        .mb-8
          %h2.text-lg.font-semibold.text-gray-900.mb-4 Invoice Information
          
          / Invoice Amount Card
          .bg-emerald-50.rounded-lg.p-6.border.border-emerald-200.mb-6
            .flex.items-center.justify-between.flex-wrap.gap-4
              %div
                %p.text-sm.font-medium.text-emerald-900.mb-1
                  Invoice Amount
                %p.text-4xl.font-bold.text-gray-900= number_to_currency(@invoice.amount)
              %div
                %p.text-sm.text-gray-600.mb-2 Payment Status
                - case @invoice.payment_status
                - when 'paid'
                  .inline-flex.items-center.px-4.py-2.bg-green-100.rounded-lg
                    %i.fas.fa-check-circle.text-green-700.mr-2
                    %span.text-lg.font-semibold.text-green-700 Payment Received
                - when 'pending'
                  .inline-flex.items-center.px-4.py-2.bg-yellow-100.rounded-lg
                    %i.fas.fa-clock.text-yellow-700.mr-2
                    %span.text-lg.font-semibold.text-yellow-700 Awaiting Payment
                - when 'overdue'
                  .inline-flex.items-center.px-4.py-2.bg-red-100.rounded-lg
                    %i.fas.fa-exclamation-triangle.text-red-700.mr-2
                    %span.text-lg.font-semibold.text-red-700 Payment Overdue

          / Invoice Items/Line Items
          - if @invoice.invoice_items.present?
            .bg-gray-50.rounded-lg.p-6.border.border-gray-200.mb-6
              %h3.text-md.font-semibold.text-gray-900.mb-4
                %i.fas.fa-list-ul.mr-2
                Invoice Items
              .overflow-x-auto
                %table.min-w-full.divide-y.divide-gray-300
                  %thead
                    %tr.bg-gray-100
                      %th.px-4.py-3.text-left.text-xs.font-medium.text-gray-700.uppercase.tracking-wider Description
                      %th.px-4.py-3.text-right.text-xs.font-medium.text-gray-700.uppercase.tracking-wider Amount
                  %tbody.bg-white.divide-y.divide-gray-200
                    - @invoice.invoice_items.each do |item|
                      %tr.hover:bg-gray-50
                        %td.px-4.py-3.text-sm.text-gray-900= item.description
                        %td.px-4.py-3.text-sm.text-gray-900.text-right.font-medium= number_to_currency(item.amount)
                    %tr.bg-gray-50.font-semibold
                      %td.px-4.py-3.text-sm.text-gray-900.text-right Total:
                      %td.px-4.py-3.text-sm.text-gray-900.text-right.text-lg= number_to_currency(@invoice.amount)

          / Payment Status Messages
          - if @invoice.payment_status == 'paid'
            .bg-green-50.rounded-lg.p-4.border.border-green-200.mb-6
              .flex.items-start
                %i.fas.fa-check-circle.text-green-600.mt-1.mr-3.text-xl
                %div
                  %p.text-sm.font-semibold.text-green-900.mb-1 Payment Received
                  %p.text-sm.text-green-800
                    This invoice has been paid. Thank you for your payment!
                  - if @invoice.paid_at.present?
                    %p.text-xs.text-green-700.mt-2
                      %i.fas.fa-calendar-check.mr-1
                      Paid on
                      = @invoice.paid_at.strftime('%B %d, %Y at %I:%M %p')

          - elsif @invoice.payment_status == 'pending' || @invoice.payment_status == 'overdue'
            - if @invoice.payment_status == 'overdue'
              .bg-red-50.rounded-lg.p-4.border.border-red-200.mb-4
                .flex.items-start
                  %i.fas.fa-exclamation-triangle.text-red-600.mt-1.mr-3.text-xl
                  %div
                    %p.text-sm.font-semibold.text-red-900.mb-1 Payment Overdue
                    %p.text-sm.text-red-800
                      This invoice is overdue. Please make payment immediately to avoid any service interruption.
            
            .bg-yellow-50.rounded-lg.p-4.border.border-yellow-200.mb-6
              .flex.items-start
                %i.fas.fa-info-circle.text-yellow-600.mt-1.mr-3.text-xl
                %div
                  %p.text-sm.font-semibold.text-yellow-900.mb-1 Payment Required
                  %p.text-sm.text-yellow-800
                    You can pay this invoice securely using your credit card below.

          / Payment Section - Only show for pending or overdue invoices
          - if @invoice.payment_status == 'pending' || @invoice.payment_status == 'overdue'
            .bg-gradient-to-r.from-purple-50.to-blue-50.rounded-lg.p-6.border.border-purple-200.mb-6
              .flex.items-center.justify-between.flex-wrap.gap-4
                %div
                  %h3.text-lg.font-semibold.text-gray-900.mb-2
                    %i.fas.fa-credit-card.mr-2.text-purple-600
                    Pay Invoice Online
                  %p.text-sm.text-gray-600.mb-1
                    Secure payment powered by
                    %span.font-semibold.text-purple-600 Stripe
                  %p.text-xs.text-gray-500
                    %i.fas.fa-lock.mr-1
                    Your payment information is encrypted and secure
                %div
                  %button.inline-flex.items-center.px-8.py-4.bg-gradient-to-r.from-purple-600.to-blue-600.hover:from-purple-700.hover:to-blue-700.text-white.font-bold.rounded-lg.transition-all.duration-200.shadow-lg.hover:shadow-xl.transform.hover:scale-105{type: 'button', data: {action: 'click->payment#openModal'}}
                    %i.fas.fa-lock.mr-2
                    %span.text-lg Pay #{number_to_currency(@invoice.amount)}
                    %i.fas.fa-arrow-right.ml-2

              / Accepted Payment Methods
              .mt-4.pt-4.border-t.border-purple-200
                %p.text-xs.text-gray-600.mb-2 We accept:
                .flex.items-center.gap-3.flex-wrap
                  .flex.items-center.gap-1.px-3.py-1.bg-white.rounded.border.border-gray-200
                    %i.fab.fa-cc-visa.text-blue-600.text-xl
                    %span.text-xs.text-gray-700 Visa
                  .flex.items-center.gap-1.px-3.py-1.bg-white.rounded.border.border-gray-200
                    %i.fab.fa-cc-mastercard.text-red-600.text-xl
                    %span.text-xs.text-gray-700 Mastercard
                  .flex.items-center.gap-1.px-3.py-1.bg-white.rounded.border.border-gray-200
                    %i.fab.fa-cc-amex.text-blue-500.text-xl
                    %span.text-xs.text-gray-700 Amex
                  .flex.items-center.gap-1.px-3.py-1.bg-white.rounded.border.border-gray-200
                    %i.fas.fa-credit-card.text-gray-600.text-xl
                    %span.text-xs.text-gray-700 Debit Card

          / Created Date
          .text-sm.text-gray-500.mt-4
            %i.fas.fa-calendar-plus.mr-2
            Invoice created on
            = @invoice.created_at.strftime('%B %d, %Y at %I:%M %p')

        %hr.my-6

        / Action Buttons
        .flex.flex-wrap.gap-3
          = link_to vendors_invoices_path, class: 'inline-flex items-center px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200 shadow-md hover:shadow-lg gap-2' do
            %i.fas.fa-list
            %span View All Invoices

          = link_to vendors_dashboard_path, class: 'inline-flex items-center px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white font-medium rounded-lg transition-colors duration-200 gap-2' do
            %i.fas.fa-arrow-left
            %span Back to Dashboard
            
          %button.inline-flex.items-center.px-4.py-2.bg-purple-600.hover:bg-purple-700.text-white.font-medium.rounded-lg.transition-colors.duration-200.shadow-md.hover:shadow-lg.gap-2{type: 'button', onclick: 'window.print()'}
            %i.fas.fa-print
            %span Print Invoice

/ Payment Modal
#paymentModal.hidden.fixed.inset-0.bg-gray-900.bg-opacity-50.z-50.flex.items-center.justify-center.p-4{data: {controller: 'payment'}}
  %div{class: "bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-y-auto max-h-[90vh]"}
    / Modal Header
    .bg-gradient-to-r.from-purple-600.to-blue-600.px-6.py-4.text-white.rounded-t-2xl
      .flex.justify-between.items-center
        .text-left
          %h3.text-xl.font-bold Secure Payment
          %p.text-sm.text-purple-100.mt-1 Powered by Stripe
        %button.text-white.hover:text-gray-200.transition-colors{type: 'button', data: {action: 'click->payment#closeModal'}}
          %i.fas.fa-times.text-2xl

    / Modal Body
    .p-6
      / Payment Summary
      .bg-gray-50.rounded-lg.p-4.mb-6
        .flex.justify-between.items-center.mb-2
          %span.text-sm.text-gray-600 Invoice Number:
          %span.text-sm.font-mono.font-semibold.text-gray-900= @invoice.id
        .flex.justify-between.items-center.mb-2
          %span.text-sm.text-gray-600 Invoice Date:
          %span.text-sm.font-semibold.text-gray-900= @invoice.created_at.strftime('%B %d, %Y')
        .pt-2.border-t.border-gray-200
          .flex.justify-between.items-center
            %span.text-sm.text-gray-600 Amount to Pay:
            %span.text-2xl.font-bold.text-gray-900= number_to_currency(@invoice.amount)

      / Payment Form
      = form_with url: pay_vendors_invoice_path(@invoice), method: :post, data: {controller: 'stripe-payment'}, class: 'space-y-4' do |f|
        / Card Element Container
        .space-y-4
          %div
            %label.block.text-sm.font-medium.text-gray-700.mb-2
              %i.fas.fa-credit-card.mr-2
              Card Information
            #card-element.p-4.border.border-gray-300.rounded-lg.bg-white.focus-within:border-purple-500.focus-within:ring-2.focus-within:ring-purple-200.transition-all
              / Stripe Card Element will be mounted here
              .text-gray-400.text-sm
                %i.fas.fa-spinner.fa-spin.mr-2
                Loading secure payment form...
            #card-errors.mt-2.text-sm.text-red-600.hidden{role: 'alert'}

          / Cardholder Name
          %div
            %label.block.text-sm.font-medium.text-gray-700.mb-2{for: 'cardholder-name'}
              %i.fas.fa-user.mr-2
              Cardholder Name
            = f.text_field :cardholder_name, value: current_vendor.full_name, class: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent', placeholder: 'John Doe', required: true

          / Email for Receipt
          %div
            %label.block.text-sm.font-medium.text-gray-700.mb-2{for: 'email'}
              %i.fas.fa-envelope.mr-2
              Email for Receipt
            = f.email_field :email, value: current_vendor.email, class: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent', placeholder: 'john@example.com', required: true

          / Save Card Option
          .flex.items-start
            = f.check_box :save_card, class: 'mt-1 h-4 w-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500'
            %label.ml-2.block.text-sm.text-gray-700{for: 'save_card'}
              Save card for future payments
              %span.block.text-xs.text-gray-500.mt-1 Securely stored for faster checkout

        / Security Notice
        .bg-blue-50.rounded-lg.p-3.border.border-blue-200
          .flex.items-start
            %i.fas.fa-shield-alt.text-blue-600.mt-0.5.mr-2
            .text-xs.text-blue-800
              %p.font-medium Your payment is secure
              %p.mt-1 We use bank-level encryption to protect your information. Your card details are never stored on our servers.

        / Action Buttons
        .flex.gap-3.pt-4
          %button.flex-1.px-6.py-3.bg-gray-200.hover:bg-gray-300.text-gray-800.font-medium.rounded-lg.transition-colors.duration-200{type: 'button', data: {action: 'click->payment#closeModal'}}
            Cancel
          %button#submit-payment.flex-1.px-6.py-3.bg-gradient-to-r.from-purple-600.to-blue-600.hover:from-purple-700.hover:to-blue-700.text-white.font-bold.rounded-lg.transition-all.duration-200.shadow-lg.hover:shadow-xl.disabled:opacity-50.disabled:cursor-not-allowed{type: 'submit', data: {action: 'click->stripe-payment#submit'}}
            %span#button-text
              %i.fas.fa-lock.mr-2
              Pay #{number_to_currency(@invoice.amount)}
            %span#loading.hidden
              %i.fas.fa-spinner.fa-spin.mr-2
              Processing...

/ Print-Only Invoice Layout
#printable-invoice.print-only
  / Logo and Company Name
  .invoice-header-section
    .company-logo
      = image_tag 'new_logo.png', alt: 'Wheels on Rent Logo', class: 'h-20 w-auto'
    %h1.main-company-name WHEELSONRENT

  / Company Info Row
  .info-row
    .company-info-left
      %p.company-name-bold Wheelsonrent-FZCO
      %p
        %strong Email:
        booking@wheelsonrent.ae
      %p
        %strong Contact Info:
        971506336408/971544083494
      %p
        %strong Website:
        www.wheelsonrent.ae
      %p
        %strong Licensed & Registered by Dubai Govt 36188

    .date-info-right
      %p
        %strong Date:
        = @invoice.created_at.strftime('%B %d')
        = ", #{@invoice.created_at.strftime('%Y')}"

  / Payment and Bank Details Row
  .payment-bank-row
    .payment-info
      %p.section-heading Payment Receipt:
      %p
        %strong Bill to:
        = current_vendor.company_name
      %p
        %strong Contact No:
        = current_vendor.phone || 'N/A'

    .bank-info
      %p
        %strong Account Holder Name:
        wheelsonrent-FZCO
      %p
        %strong Bank Name:
        Rak Bank
      %p
        %strong Swift Code:
        NRAKAEAXXX
      %p
        %strong Account No:
        0323281319001
      %p
        %strong IBAN:
        AE54 0400 0003 2328 1319 001

  / Heavy Divider Line
  .heavy-divider

  / Invoice Items Table
  .invoice-items-table
    .table-header-row
      .description-header Description
      .amount-header Amount

    - @invoice.invoice_items.each do |item|
      .table-row
        .description-cell= item.description
        .amount-cell= "AED #{number_with_precision(item.amount, precision: 0)}"

    .table-total-row
      .total-label Total
      .total-amount= "AED #{number_with_precision(@invoice.invoice_items.sum(:amount), precision: 0)}"

  / Terms & Conditions
  .terms-conditions-section
    %h3 Terms & Conditions
    %ul
      %li All payments made to "Wheelsonrent-FZCO" are final and non refundable.
      %li We are dedicated to providing high quality service on time.
      %li Monthly charges are applicable at the start of every month.
      %li Payments must be made as per agreed schedule to ensure smooth service delivery. Any delays in payment may affect the continuation of the service provided.
      %li By submitting payment to "wheelsonrent-FZCO" you agree to these terms and conditions.
      %li We are committed to delivering exceptional value and appreciate your partnership.

  / Company Stamp
  .company-stamp-section
    = image_tag 'company-stamp.png', alt: 'stamp', class: 'h-22 w-auto pl-20 pt-5'



/ Add Stimulus Controllers for Payment Modal
:javascript
  // Payment Modal Controller
  document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('paymentModal');
    const openButtons = document.querySelectorAll('[data-action="click->payment#openModal"]');
    const closeButtons = document.querySelectorAll('[data-action="click->payment#closeModal"]');
    
    openButtons.forEach(button => {
      button.addEventListener('click', () => {
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      });
    });
    
    closeButtons.forEach(button => {
      button.addEventListener('click', () => {
        modal.classList.add('hidden');
        document.body.style.overflow = 'auto';
      });
    });
    
    // Close on outside click
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.classList.add('hidden');
        document.body.style.overflow = 'auto';
      }
    });
    
    // Close on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
        modal.classList.add('hidden');
        document.body.style.overflow = 'auto';
      }
    });
  });

:css
  /* Hide print layout on screen */
  .print-only {
    display: none;
  }

  @media print {
    /* Hide everything except print layout */
    body * {
      visibility: hidden;
    }

    #printable-invoice, #printable-invoice * {
      visibility: visible;
    }

    .no-print {
      display: none !important;
    }

    .print-only {
      display: block !important;
    }

    body {
      background: white !important;
      margin: 0;
      padding: 0;
    }

    #printable-invoice {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      padding: 0px 50px;
      font-family: Arial, sans-serif;
      color: #2c5353;
      font-size: 9pt;
      line-height: 1.5;
    }

    /* Header Section */
    .invoice-header-section {
      text-align: center;
      margin-bottom: 10px;
    }

    .company-logo {
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
    }

    .main-company-name {
      font-size: 22pt;
      font-weight: bold;
      letter-spacing: 3px;
      color: #2c5353;
    }

    /* Info Row */
    .info-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 25px;
      font-size: 10pt;
    }

    .company-info-left {
      text-align: left;
      line-height: 1.8;
    }

    .company-name-bold {
      font-weight: bold;
      font-size: 11pt;
      margin-bottom: 3px;
    }

    .date-info-right {
      text-align: right;
      font-weight: bold;
    }

    /* Payment and Bank Row */
    .payment-bank-row {
      display: flex;
      justify-content: space-between;
      margin: 5px 0;
      font-size: 10pt;
      line-height: 1.8;
    }

    .payment-info {
      flex: 1;
    }

    .bank-info {
      flex: 1;
      text-align: right;
    }

    .section-heading {
      font-weight: bold;
      margin-bottom: 8px;
    }

    /* Heavy Divider */
    .heavy-divider {
      height: 4px;
      background-color: #2c5353;
    }

    .table-header-row {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid #ddd;
      font-weight: bold;
      font-size: 11pt;
      text-transform: uppercase;
    }

    .description-header {
      flex: 1;
      text-align: left;
    }

    .amount-header {
      width: 150px;
      text-align: right;
    }

    .table-row {
      display: flex;
      justify-content: space-between;
      padding: 7px 0;
      border-bottom: 1px solid #eee;
      font-size: 11pt;
    }

    .description-cell {
      flex: 1;
      text-align: left;
      line-height: 1.6;
    }

    .amount-cell {
      width: 150px;
      text-align: right;
      font-weight: 500;
    }

    .table-total-row {
      display: flex;
      justify-content: space-between;
      padding: 2px 0;
      border-top: 3px solid #2c5353;
      font-weight: bold;
      font-size: 14pt;
    }

    .total-label {
      flex: 1;
      text-align: right;
    }

    .total-amount {
      width: 150px;
      text-align: right;
    }

    /* Terms Section */
    .terms-conditions-section {
      margin: 10px 0 0;
      font-size: 9.5pt;
    }

    .terms-conditions-section h3 {
      font-size: 12pt;
      font-weight: bold;
    }

    .terms-conditions-section ul {
      list-style-type: disc;
      padding-left: 20px;
      line-height: 1.5;
    }

    /* Company Stamp */
    .company-stamp-section {
      text-align: center;
      margin: 0 0 40px;
    }

    /* Ensure page doesn't break in the middle */
    #printable-invoice {
      page-break-inside: avoid;
    }
  }