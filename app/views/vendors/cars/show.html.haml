- content_for :title, "Rent #{@car.full_name} in Dubai | Wheels on Rent"
- content_for :description, "Rent #{@car.full_name} in Dubai starting from AED #{@car.daily_price}/day.}"
- min_days = ['Luxury', 'Sports', 'Convertible'].include?(@car.category) ? 1 : 7

.container.mx-auto.max-w-7xl.p-6
  = render partial: "vendors/navbar"
  
  / Hero Section with Car Images
  .bg-white.rounded-2xl.shadow-xl.overflow-hidden.mb-8
    .relative.h-96.bg-gradient-to-r.from-blue-50.to-indigo-50
      = car_image_slider(@car, height: 'h-96', show_counter: true, show_navigation: true, show_pagination: true)
    
    / Car Title and Actions
    .p-8
      .flex.flex-col.md:flex-row.md:items-center.md:justify-between.gap-4
        .flex-1
          %h1.text-4xl.font-extrabold.mb-2{style: 'color: #2d4f4f'}
            = "#{@car.brand} #{@car.model}"
            - if @car.featured?
              %span.inline-flex.items-center.px-2.py-1.rounded-full.text-xs.font-bold.bg-yellow-100.text-yellow-800.ml-2.align-middle
                %i.fas.fa-star.mr-1
                Featured
            - if @car.with_driver?
              %span.inline-block.bg-blue-100.text-blue-700.text-sm.font-semibold.px-3.py-1.rounded-full.ml-3.align-middle With Driver
          .flex.items-center.gap-4.mb-4
            %span.text-lg.text-gray-600= @car.year
            %span.text-lg.text-gray-600= @car.color
            %span.text-lg.text-gray-600= @car.category.presence || '—'
          .flex.items-center.gap-4
            - if @car.with_driver?
              - if @car.has_discount?
                %span.text-2xl.font-bold.text-gray-400.line-through= @car.five_hours_charge ? number_to_currency(@car.five_hours_charge) : 'N/A'
                %span.text-2xl.font-bold.text-red-600= number_to_currency(@car.discounted_five_hours_charge)
                %span.text-gray-500 /5h
                %span.text-2xl.font-bold.text-gray-400.line-through= @car.ten_hours_charge ? number_to_currency(@car.ten_hours_charge) : 'N/A'
                %span.text-2xl.font-bold.text-red-600= number_to_currency(@car.discounted_ten_hours_charge)
                %span.text-gray-500 /10h
              - else
                %span.text-2xl.font-bold{style: 'color: #3a6363'}= @car.five_hours_charge ? number_to_currency(@car.five_hours_charge) : 'N/A'
                %span.text-gray-500 /5h
                %span.text-2xl.font-bold{style: 'color: #3a6363'}= @car.ten_hours_charge ? number_to_currency(@car.ten_hours_charge) : 'N/A'
                %span.text-gray-500 /10h
            - else
              - status_classes = {'available' => 'bg-green-100 text-green-700', 'rented' => 'bg-red-100 text-red-700', 'maintenance' => 'bg-yellow-100 text-yellow-700'}
              %span.inline-block.rounded-full.text-sm.font-semibold.px-4.py-2{class: status_classes[@car.status] || 'bg-blue-100 text-blue-700'}= @car.status.titleize
              %span.text-2xl.font-bold{style: 'color: #3a6363'}= @car.daily_price ? number_to_currency(@car.daily_price) : 'N/A'
              %span.text-gray-500   /day
              %span.text-2xl.font-bold{style: 'color: #3a6363'}= @car.weekly_price ? number_to_currency(@car.weekly_price) : 'N/A'
              %span.text-gray-500 /week
              %span.text-2xl.font-bold{style: 'color: #3a6363'}= @car.monthly_price ? number_to_currency(@car.monthly_price) : 'N/A'
              %span.text-gray-500 /month
        .flex.gap-3
          = link_to vendors_edit_car_path(@car), class: 'text-white font-semibold px-6 py-3 rounded-lg transition flex items-center gap-2', style: 'background-color:#3a6363' do
            %i.fas.fa-edit
            Edit Car
          = link_to vendors_car_path(@car), data: { turbo_method: :delete, turbo_confirm: 'Are you sure you want to delete this car?' }, class: 'bg-red-600 hover:bg-red-700 text-white font-semibold px-6 py-3 rounded-lg transition flex items-center gap-2' do
            %i.fas.fa-trash
            Delete

  / Main Content Grid
  .grid.grid-cols-1.lg:grid-cols-3.gap-8
    / Left Column - Car Details
    .lg:col-span-2.space-y-6
      / Rental Terms (from public show)
      .bg-white.rounded-xl.shadow-lg
        .px-6.py-4.border-b
          %h3.font-semibold.text-gray-900 Rental Terms
        .p-6
          .grid.grid-cols-1.sm:grid-cols-2.gap-x-10.gap-y-5.place-items-center.text-center
            .flex.items-center.justify-center.gap-3
              %i.fas.fa-tachometer-alt.text-xl.text-gray-700
              %span.text-gray-800 Mileage Policy
              %button.text-gray-400.hover:text-gray-600{ "data-policy" => "mileage" }
                %i.fas.fa-info-circle
            .flex.items-center.justify-center.gap-3
              %i.fas.fa-gas-pump.text-xl.text-gray-700
              %span.text-gray-800 Fuel Policy
              %button.text-gray-400.hover:text-gray-600{ "data-policy" => "fuel" }
                %i.fas.fa-info-circle
            .flex.items-center.justify-center.gap-3
              %i.fas.fa-file-alt.text-xl.text-gray-700
              %span.text-gray-800 Rental Policy
              %button.text-gray-400.hover:text-gray-600{ "data-policy" => "rental" }
                %i.fas.fa-info-circle
            .flex.items-center.justify-center.gap-3
              %i.fas.fa-shield-alt.text-xl.text-gray-700
              %span.text-gray-800 Insurance Policy
              %button.text-gray-400.hover:text-gray-600{ "data-policy" => "insurance" }
                %i.fas.fa-info-circle

      / Minimum Rental Duration Info
      .bg-white.rounded-xl.shadow-lg.mb-6
        .p-6
          .flex.flex-col.sm:flex-row.items-center.justify-center.gap-6.text-center
            .flex.items-center.gap-3
              %span.inline-flex.items-center.justify-center.w-6.h-6.rounded-full.bg-green-500.text-white
                %i.fas.fa-check.text-xs
              %span.text-gray-800= "Minimum #{min_days} days rental"

      / Basic Information Card
      .bg-white.rounded-xl.shadow-lg.p-6
        %h2.text-xl.font-bold.mb-4.flex.items-center.gap-2{style: 'color:#2d4f4f'}
          %i.fas.fa-info-circle{style: 'color: #3a6363'}
          Basic Information
        .grid.grid-cols-1.md:grid-cols-2.gap-4
          .flex.justify-between.py-2.border-b.border-gray-100
            %span.font-medium.text-gray-600 Model
            %span.text-gray-900= @car.model
          .flex.justify-between.py-2.border-b.border-gray-100
            %span.font-medium.text-gray-600 Brand
            %span.text-gray-900= @car.brand
          - unless @car.with_driver?
            .flex.justify-between.py-2.border-b.border-gray-100
              %span.font-medium.text-gray-600 Year
              %span.text-gray-900= @car.year
          .flex.justify-between.py-2.border-b.border-gray-100
            %span.font-medium.text-gray-600 Color
            %span.text-gray-900= @car.color
          - unless @car.with_driver?
            .flex.justify-between.py-2.border-b.border-gray-100
              %span.font-medium.text-gray-600 Category
              %span.text-gray-900= @car.category.presence || '—'
          - if @car.with_driver?
            .flex.justify-between.py-2.border-b.border-gray-100
              %span.font-medium.text-gray-600 5 Hours Charge
              - if @car.has_discount?
                .flex.flex-col.items-end
                  %span.text-gray-400.line-through= number_to_currency(@car.five_hours_charge)
                  %span.text-green-600.font-bold= number_to_currency(@car.discounted_five_hours_charge)
              - else
                %span.text-gray-900= @car.five_hours_charge ? number_to_currency(@car.five_hours_charge) : 'N/A'
            .flex.justify-between.py-2.border-b.border-gray-100
              %span.font-medium.text-gray-600 10 Hours Charge
              - if @car.has_discount?
                .flex.flex-col.items-end
                  %span.text-gray-400.line-through= number_to_currency(@car.ten_hours_charge)
                  %span.text-green-600.font-bold= number_to_currency(@car.discounted_ten_hours_charge)
              - else
                %span.text-gray-900= @car.ten_hours_charge ? number_to_currency(@car.ten_hours_charge) : 'N/A'
          - else
            .flex.justify-between.py-2.border-b.border-gray-100
              %span.font-medium.text-gray-600 Daily Price
              %span.text-gray-900= @car.daily_price ? number_to_currency(@car.daily_price) : 'N/A'
            .flex.justify-between.py-2.border-b.border-gray-100
              %span.font-medium.text-gray-600 Weekly Price
              %span.text-gray-900= @car.weekly_price ? number_to_currency(@car.weekly_price) : 'N/A'
            .flex.justify-between.py-2.border-b.border-gray-100
              %span.font-medium.text-gray-600 Monthly Price
              %span.text-gray-900= @car.monthly_price ? number_to_currency(@car.monthly_price) : 'N/A'
            .flex.justify-between.py-2.border-b.border-gray-100
              %span.font-medium.text-gray-600 Additional Mileage Charge
              %span.text-gray-900= @car.additional_mileage_charge ? number_to_currency(@car.additional_mileage_charge) : 'N/A'

      / Specifications Card
      .bg-white.rounded-xl.shadow-lg.p-6
        %h2.text-xl.font-bold.mb-4.flex.items-center.gap-2{style: 'color:#2d4f4f'}
          %i.fas.fa-cogs{style: 'color: #3a6363'}
          Specifications
        .grid.grid-cols-1.md:grid-cols-2.gap-4
          .flex.justify-between.py-2.border-b.border-gray-100
            %span.font-medium.text-gray-600 Transmission
            %span.text-gray-900= @car.transmission.presence || '—'
          .flex.justify-between.py-2.border-b.border-gray-100
            %span.font-medium.text-gray-600 Fuel Type
            %span.text-gray-900= @car.fuel_type.presence || '—'
          .flex.justify-between.py-2.border-b.border-gray-100
            %span.font-medium.text-gray-600 Seats
            %span.text-gray-900= @car.seats.presence || '—'
          .flex.justify-between.py-2.border-b.border-gray-100
            %span.font-medium.text-gray-600 Daily Mileage
            %span.text-gray-900= @car.daily_milleage.presence || '—'
          .flex.justify-between.py-2.border-b.border-gray-100
            %span.font-medium.text-gray-600 Weekly Mileage
            %span.text-gray-900= @car.weekly_milleage.presence || '—'
          .flex.justify-between.py-2.border-b.border-gray-100
            %span.font-medium.text-gray-600 Monthly Mileage
            %span.text-gray-900= @car.monthly_milleage.presence || '—'
          .flex.justify-between.py-2.border-b.border-gray-100
            %span.font-medium.text-gray-600 Engine Size
            %span.text-gray-900= @car.engine_size.presence || '—'

      / Features & Specs Section
      .bg-white.rounded-xl.shadow-lg.p-6
        %h2.text-2xl.font-bold.mb-6{style: 'color: #2d4f4f'} FEATURES & SPECS
        
        - if @car.features.any?
          .relative
            #featuresGrid.grid.grid-cols-1.sm:grid-cols-2.md:grid-cols-3.lg:grid-cols-4.gap-4
              - if @car.with_driver?
                .flex.items-center.feature-item.bg-blue-50.p-2.rounded-lg.border.border-blue-100{class: '', 'data-index': -1}
                  %i.fas.fa-user-tie.mr-3.text-blue-500
                  %span.text-gray-700.font-medium With Driver Service
                  %span.ml-1.text-xs.text-blue-600 ⭐

              - @car.features.each_with_index do |feature, index|
                .flex.items-center.feature-item{class: index >= 12 ? 'hidden' : '', 'data-index': index}
                  %i.fas.fa-check-circle.mr-3{class: feature.common ? 'text-green-500' : 'text-purple-500'}
                  %span.text-gray-700
                    = feature.name
                    - unless feature.common
                      %span.ml-1.text-xs.text-purple-600 ⭐
            
            - if @car.features.count > 12
              .mt-6.text-center
                %button#showMoreFeaturesBtn.px-6.py-3.text-white.rounded-lg.font-semibold.transition-all.duration-200.shadow-md.hover:shadow-lg.flex.items-center.justify-center.mx-auto.gap-2{style: 'background-color: #3a6363'}
                  %span#btnText Show More Features
                  %i.fas.fa-chevron-down#btnIcon
        - else
          .text-center.py-8.text-gray-500
            %i.fas.fa-info-circle.text-3xl.mb-3
            %p No features available for this vehicle

    / Right Column - Sidebar
    .space-y-6
      / Car Stats Card
      .bg-white.rounded-xl.shadow-lg.p-6
        %h2.text-xl.font-bold.mb-4.flex.items-center.gap-2{style: 'color:#2d4f4f'}
          %i.fas.fa-chart-bar{style: 'color: #3a6363'}
          Car Stats
        .space-y-4
          .flex.justify-between.items-center.py-2.border-b.border-gray-100
            %span.font-medium.text-gray-600 Created
            %span.text-gray-900= @car.created_at.strftime('%b %d, %Y')
          .flex.justify-between.items-center.py-2.border-b.border-gray-100
            %span.font-medium.text-gray-600 Updated
            %span.text-gray-900= @car.updated_at.strftime('%b %d, %Y')
          .flex.justify-between.items-center.py-2.border-b.border-gray-100
            %span.font-medium.text-gray-600 Total Bookings
            %span.text-gray-900= @bookings.count
          .flex.justify-between.items-center.py-2
            %span.font-medium.text-gray-600 Active Bookings
            %span.text-gray-900= @bookings.where(status: 'Pending').count

      / Quick Actions Card
      .bg-white.rounded-xl.shadow-lg.p-6
        %h2.text-xl.font-bold.mb-4.flex.items-center.gap-2{style: 'color:#2d4f4f'}
          %i.fas.fa-bolt{style: 'color: #3a6363'}
          Quick Actions
        .space-y-3
          = link_to vendors_edit_car_path(@car), class: 'w-full text-white font-medium px-4 py-3 rounded-lg transition flex items-center justify-center gap-2', style: 'background-color:#3A6363' do
            %i.fas.fa-edit
            Edit Car Details
          = link_to vendors_cars_path, class: 'w-full bg-gray-50 hover:bg-gray-100 text-gray-700 font-medium px-4 py-3 rounded-lg transition flex items-center justify-center gap-2' do
            %i.fas.fa-arrow-left
            Back to Cars

      / Enhanced Mulkiya Card
      .bg-white.rounded-2xl.shadow-xl.border.border-gray-100.overflow-hidden.transition-all.duration-300
        / Header Section
        .bg-gradient-to-r.from-slate-50.to-gray-50.px-6.py-4.border-b.border-gray-100
          %h2.text-xl.font-bold.flex.items-center.gap-3{style: 'color:#3A6363'}
            .p-2.rounded-lg{style: 'background-color:#E6F0F0'}
              %i.fas.fa-id-card{style: 'color:#3A6363'}
            Mulkiya

        / Content Section  
        .p-6
          - if @car.car_document.present? && @car.car_document.mulkiya.attached?
            .space-y-4
              / Document Preview & Actions Row
              .flex.flex-col.lg:flex-row.gap-4.items-start
                / Document Preview
                .flex-shrink-0.w-full.lg:w-40
                  .w-full.lg:w-40.h-32.rounded-xl.overflow-hidden.bg-gradient-to-br.from-gray-50.to-gray-100.border-2.border-dashed.flex.items-center.justify-center.relative.group.transition-all.duration-300.hover:shadow-lg{style: 'border-color:#3A6363'}
                    - content_type = @car.car_document.mulkiya.content_type.to_s
                    - if content_type.start_with?("image/")
                      = image_tag url_for(@car.car_document.mulkiya.variant(resize_to_fill: [160, 128])), class: 'w-full h-full object-cover transition-transform duration-300 group-hover:scale-110'
                      .absolute.inset-0.bg-black.bg-opacity-0.group-hover:bg-opacity-20.transition-all.duration-300.flex.items-center.justify-center
                        %i.fas.fa-search-plus.text-white.opacity-0.group-hover:opacity-100.text-xl
                    - elsif content_type == 'application/pdf'
                      .text-center.space-y-2
                        %i.fas.fa-file-pdf.text-4xl.text-red-500
                        %span.text-xs.font-medium.text-gray-600 PDF Document
                    - else
                      .text-center.space-y-2
                        %i.fas.fa-file-alt.text-4xl.text-gray-400
                        %span.text-xs.font-medium.text-gray-600 Document
          
                / Document Info & Actions
                .flex-1.min-w-0.space-y-4
            
                  / Action Buttons & Status
                  .flex.flex-col.sm:flex-row.gap-3.items-start.sm:items-center.justify-between.flex-wrap
                    / Download Button
                    = link_to url_for(@car.car_document.mulkiya), target: '_blank', class: 'inline-flex items-center gap-1 px-3 py-2 text-white text-sm font-medium rounded-md transition-all duration-200 shadow hover:shadow-md whitespace-nowrap', style: 'background-color:#3A6363; hover:background-color:#2d4f4f' do
                      %i.fas.fa-download
                      %span View & Download
                
                    / Status Badge
                    - status = @car.car_document.document_status
                    - case status
                    - when 'approved'
                      - badge_classes = 'bg-emerald-50 text-emerald-700 border-emerald-200'
                      - icon_class = 'fas fa-check-circle text-emerald-600'
                    - when 'rejected'
                      - badge_classes = 'bg-red-50 text-red-700 border-red-200'
                      - icon_class = 'fas fa-times-circle text-red-600'
                    - when 'pending'
                      - badge_classes = 'bg-amber-50 text-amber-700 border-amber-200'
                      - icon_class = 'fas fa-clock text-amber-600'
                    - else
                      - badge_classes = 'bg-gray-50 text-gray-700 border-gray-200'
                      - icon_class = 'fas fa-question-circle text-gray-600'
                
                    .inline-flex.items-center.gap-2.px-3.py-2.rounded-lg.text-sm.font-semibold.border-2.transition-all.duration-200.whitespace-nowrap{class: badge_classes}
                      %i{class: icon_class}
                      %span= status.to_s.titleize
        
          - else
            / Empty State
            .text-center.py-12.space-y-6
              .w-24.h-24.mx-auto.rounded-full.flex.items-center.justify-center{style: 'background-color:#E6F0F0'}
                %i.fas.fa-file-plus.text-3xl{style: 'color:#3A6363'}
              .space-y-2
                %h3.text-lg.font-semibold.text-gray-800 No Mulkiya Document
                %p.max-w-md.mx-auto.leading-relaxed.break-words{style: 'color:#3A6363'}
                  Upload Mulkiya document to complete your car profile and enable verification.

  / Car Overview Section (from public show)
  .mt-8
    .bg-white.rounded-xl.shadow-lg.p-8
      %h2.text-2xl.font-bold.mb-6{style: 'color: #2d4f4f'} Car Overview
      .grid.grid-cols-2.md:grid-cols-3.lg:grid-cols-4.gap-6
        - unless @car.with_driver?
          .flex.items-center.space-x-3
            %i.fas.fa-car.text-gray-400.w-5
            .div
              %span.text-sm.text-gray-500 Body Type
              %p.font-medium= @car.category || 'Sedan'
        - unless @car.with_driver?
          .flex.items-center.space-x-3
            %i.fas.fa-calendar.text-gray-400.w-5
            .div
              %span.text-sm.text-gray-500 Model
              %p.font-medium= @car.year || '2021'
        .flex.items-center.space-x-3
          %i.fas.fa-palette.text-gray-400.w-5
          .div
            %span.text-sm.text-gray-500 Colour
            %p.font-medium= @car.color || 'Black'
        - unless @car.with_driver?
          .flex.items-center.space-x-3
            %i.fas.fa-gas-pump.text-gray-400.w-5
            .div
              %span.text-sm.text-gray-500 Fuel
              %p.font-medium= @car.fuel_type || 'Petrol'
        - unless @car.with_driver?
          .flex.items-center.space-x-3
            %i.fas.fa-cogs.text-gray-400.w-5
            .div
              %span.text-sm.text-gray-500 Transmission
              %p.font-medium= @car.transmission || 'Auto'
        .flex.items-center.space-x-3
          %i.fas.fa-users.text-gray-400.w-5
          .div
            %span.text-sm.text-gray-500 Seating Capacity
            %p.font-medium= "#{@car.seats || 5} passengers"
        - if @car.with_driver?
          .flex.items-center.space-x-3
            %i.fas.fa-suitcase.text-gray-400.w-5
            .div
              %span.text-sm.text-gray-500 Luggage Capacity
              %p.font-medium= "#{@car.luggage_capacity || 0} Bags"
        - unless @car.with_driver?
          .flex.items-center.space-x-3
            %i.fas.fa-engine.text-gray-400.w-5
            .div
              %span.text-sm.text-gray-500 Engine CC
              %p.font-medium= @car.engine_size || '2.0L'

        - if @car.with_driver?
          .flex.items-center.space-x-3
            %i.fas.fa-user-tie.text-gray-400.w-5
            .div
              %span.text-sm.text-gray-500 Service Type
              %p.font-medium.text-blue-600 With Driver Available

  / Required Document Section
  .mt-8
    .mx-auto
      .bg-white.rounded-2xl.shadow-lg.p-8

        / Required Documents Section
        .mb-8
          .text-xl.font-bold.text-gray-800.mb-4 ✅ Required Documents
          %ul.text-gray-700.text-left.max-w-2xl.mx-10.list-disc.pl-6.space-y-2
            %li
              %strong Tourists / Non-Residents:
              | Passport copy, home country license, International Driving Permit (if required), Visa Copy.
            %li
              %strong Residents:
              | Emirates ID, UAE driving license.
            %li
              %strong GCC Nationals:
              | GCC ID or Passport, GCC driving license.

        / Before Delivery Section
        .mb-8
          .text-xl.font-bold.text-gray-800.mb-4 ✅ Before Delivery
          %ul.text-gray-700.text-left.max-w-2xl.mx-10.list-disc.pl-6.space-y-2
            %li Customers must present the receipt received during booking with Wheelsonrent at the time of car collection.
            %li Collect payment receipt.
            %li Collect a copy of the rental agreement.

        / Note Section
        .mb-8
          .text-xl.font-bold.text-gray-800.mb-4 ⚠️ Note
          %ul.text-gray-700.text-left.max-w-2xl.mx-10.list-disc.pl-6.space-y-2
            %li Wheelsonrent platform only displays cars and manages reservations.
            %li Wheelsonrent bears no responsibility for rental payments made between the customer and the car rental company.

  / Bookings Section
  .mt-8
    .bg-white.rounded-xl.shadow-lg.p-6
      %h2.text-xl.font-bold.mb-6.flex.items-center.gap-2{style: 'color:#2d4f4f'}
        %i.fas.fa-calendar-alt{style: 'color: #3a6363'}
        Bookings for this Car
      
      - if @bookings.any?
        .overflow-x-auto
          %table.min-w-full
            %thead
              %tr.border-b.border-gray-200
                %th.px-4.py-3.text-left.text-xs.font-semibold.text-gray-600.uppercase.tracking-wider User
                %th.px-4.py-3.text-left.text-xs.font-semibold.text-gray-600.uppercase.tracking-wider Start Date
                %th.px-4.py-3.text-left.text-xs.font-semibold.text-gray-600.uppercase.tracking-wider End Date
                %th.px-4.py-3.text-left.text-xs.font-semibold.text-gray-600.uppercase.tracking-wider Status
                %th.px-4.py-3.text-left.text-xs.font-semibold.text-gray-600.uppercase.tracking-wider Payment
            %tbody.divide-y.divide-gray-200
              - @bookings.each do |booking|
                %tr.hover:bg-gray-50.transition
                  %td.px-4.py-4.whitespace-nowrap
                    .flex.flex-col
                      %span.font-medium.text-gray-900= booking.user&.full_name || 'N/A'
                      %span.text-sm.text-gray-500= booking.user&.email
                  %td.px-4.py-4.whitespace-nowrap.text-gray-900= booking.start_date.strftime('%b %d, %Y')
                  %td.px-4.py-4.whitespace-nowrap.text-gray-900= booking.end_date.strftime('%b %d, %Y')
                  %td.px-4.py-4.whitespace-nowrap
                    - status_classes = {'Pending' => 'bg-yellow-100 text-yellow-700', 'Confirmed' => 'bg-green-100 text-green-700', 'Cancelled' => 'bg-red-100 text-red-700'}
                    %span.inline-block.rounded-full.text-xs.font-semibold.px-3.py-1{class: status_classes[booking.status] || 'bg-gray-100 text-gray-700'}= booking.status
                  %td.px-4.py-4.whitespace-nowrap
                    - if booking.payment_processed?
                      %span.inline-block.bg-green-100.text-green-700.px-3.py-1.rounded-full.text-xs.font-semibold Paid
                    - else
                      %span.inline-block.bg-yellow-100.text-yellow-700.px-3.py-1.rounded-full.text-xs.font-semibold Pending
      - else
        .text-center.py-8
          %i.fas.fa-calendar-times.text-4xl.text-gray-300.mb-4
          %p.text-gray-500.text-lg No bookings for this car yet.
          %p.text-gray-400.text-sm This car is available for new bookings.

  / Right-side Drawer for policy info
  #policyDrawer.fixed.top-0.right-0.h-full.w-96.bg-white.shadow-2xl.transform.translate-x-full.transition-transform.duration-300.z-50{ 'aria-hidden' => 'true' }
    .flex.items-center.justify-between.px-5.py-4.border-b
      %h5#policyDrawerTitle.text-lg.font-bold{style: 'color:#2d4f4f'} Policy Details
      %button#closePolicyDrawer.text-gray-400.hover:text-gray-600{ type: 'button', 'aria-label' => 'Close' }
        %i.fas.fa-times
    .p-5.overflow-y-auto.h-full
      #policyDrawerContent.text-gray-700
        / Content populated by JavaScript

:javascript
  // Initialize Swiper with better timing and Turbo support
  function initializeSwiper() {
    // Wait for Swiper to be available
    if (typeof Swiper === 'undefined') {
      setTimeout(initializeSwiper, 50);
      return;
    }
    
    const swiperContainer = document.querySelector('.swiper-container');
    if (!swiperContainer) {
      return;
    }
    
    // Destroy existing swiper instance if it exists
    if (swiperContainer.swiper) {
      swiperContainer.swiper.destroy(true, true);
    }
    
    const swiper = new Swiper('.swiper-container', {
      loop: true,
      navigation: {
        nextEl: '.swiper-button-next',
        prevEl: '.swiper-button-prev',
      },
      pagination: {
        el: '.swiper-pagination',
        clickable: true,
        dynamicBullets: true,
      },
      slidesPerView: 1,
      spaceBetween: 0,
      centeredSlides: true,
      autoHeight: true,
      effect: 'fade',
      fadeEffect: {
        crossFade: true
      },
      on: {
        slideChange: function() {
          // Update image counter
          const currentSlide = this.realIndex + 1;
          const totalSlides = this.slides.length;
          const counter = document.querySelector('.current-slide');
          if (counter) {
            counter.textContent = currentSlide;
          }
        }
      }
    });
  }

  // Show More Features functionality
  function initializeFeaturesToggle() {
    const showMoreBtn = document.getElementById('showMoreFeaturesBtn');
    
    if (!showMoreBtn) return; // Exit if button doesn't exist
    
    let isExpanded = false;
    
    // Remove any existing event listeners to avoid duplicates
    const newBtn = showMoreBtn.cloneNode(true);
    showMoreBtn.parentNode.replaceChild(newBtn, showMoreBtn);
    
    newBtn.addEventListener('click', function() {
      const allFeatures = document.querySelectorAll('.feature-item');
      const newBtnText = this.querySelector('#btnText');
      const newBtnIcon = this.querySelector('#btnIcon');
      
      if (!isExpanded) {
        // Show all features
        allFeatures.forEach(function(feature) {
          feature.classList.remove('hidden');
        });
        if (newBtnText) newBtnText.textContent = 'Show Less Features';
        if (newBtnIcon) {
          newBtnIcon.classList.remove('fa-chevron-down');
          newBtnIcon.classList.add('fa-chevron-up');
        }
        isExpanded = true;
      } else {
        // Hide features after index 11
        allFeatures.forEach(function(feature) {
          const index = parseInt(feature.getAttribute('data-index'));
          if (index >= 12) {
            feature.classList.add('hidden');
          }
        });
        if (newBtnText) newBtnText.textContent = 'Show More Features';
        if (newBtnIcon) {
          newBtnIcon.classList.remove('fa-chevron-up');
          newBtnIcon.classList.add('fa-chevron-down');
        }
        isExpanded = false;
        
        // Scroll back to features section
        const featuresGrid = document.querySelector('#featuresGrid');
        if (featuresGrid) {
          featuresGrid.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
      }
    });
  }

  // Policy Drawer Setup
  function setupPolicyDrawer() {
    const drawer = document.getElementById('policyDrawer');
    const closeBtn = document.getElementById('closePolicyDrawer');
    const contentEl = document.getElementById('policyDrawerContent');
    const titleEl = document.getElementById('policyDrawerTitle');
    
    if (!drawer || !closeBtn) return;

    // Insurance policy content
    const insurancePolicy = #{ @car.insurance_policy.present? ? @car.insurance_policy.to_json : "'No Insurance Provided'" };

    const policies = {
      mileage: {
        title: 'Mileage Policy',
        content: 'Most rentals come with a daily mileage limit (200-250 km per day). Exceeding this limit will result in additional charges of AED 0.50 per extra kilometer. Some rental companies also offer unlimited mileage or extra mileage packages.'
      },
      fuel: {
        title: 'Fuel Policy',
        content: 'The vehicle will be provided with a full tank of fuel. You are required to return the vehicle with the same fuel level. If returned with less fuel, you will be charged for refueling at current market rates plus a service fee.'
      },
      rental: {
        title: 'Rental Policy',
        content: 'Renters must be at least 21 years old. UAE residents need a valid UAE driving license, and tourists must provide an International Driving Permit. Any traffic fines incurred during the rental period are the renter\'s responsibility. Vehicles should be returned to the original pickup location unless alternative arrangements have been approved in advance.'
      },
      insurance: {
        title: 'Insurance Policy',
        content: insurancePolicy
      }
    };

    // Close drawer function
    const closePolicyDrawer = function() {
      drawer.setAttribute('aria-hidden', 'true');
      drawer.classList.add('translate-x-full');
    };

    // Open drawer function
    const openPolicyDrawer = function(policyKey) {
      const policy = policies[policyKey];
      if (!policy) return;
      
      if (titleEl) titleEl.textContent = policy.title;
      if (contentEl) contentEl.innerHTML = '<p class="text-gray-700 leading-relaxed">' + policy.content + '</p>';
      
      drawer.setAttribute('aria-hidden', 'false');
      drawer.classList.remove('translate-x-full');
    };

    // Close button listener
    closeBtn.addEventListener('click', closePolicyDrawer);

    // ESC key to close
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closePolicyDrawer();
      }
    });

    // Policy buttons listener
    const policyButtons = document.querySelectorAll('[data-policy]');
    policyButtons.forEach(function(btn) {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        const policyType = this.getAttribute('data-policy');
        openPolicyDrawer(policyType);
      });
    });
  }

  // Initialize all functionality
  function initializeAll() {
    initializeSwiper();
    initializeFeaturesToggle();
    setupPolicyDrawer();
  }

  // Multiple initialization triggers for different scenarios
  document.addEventListener('DOMContentLoaded', function() {
    initializeAll();
  });
  
  document.addEventListener('turbo:load', function() {
    initializeAll();
  });
  
  document.addEventListener('turbo:render', function() {
    initializeAll();
  });
  
  // Immediate initialization if DOM is already ready
  if (document.readyState !== 'loading') {
    setTimeout(function() {
      initializeAll();
    }, 100);
  }
