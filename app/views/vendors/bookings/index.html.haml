.container.mx-auto.max-w-7xl.p-3.sm:p-4.md:p-6
  = render partial: "vendors/navbar"

  / Header Section
  .bg-white.rounded-xl.sm:rounded-2xl.shadow-xl.p-4.sm:p-6.md:p-8.mb-4.sm:mb-6.md:mb-8
    .flex.flex-col.md:flex-row.md:items-center.md:justify-between.gap-3.sm:gap-4
      .flex-1
        %h1.text-2xl.sm:text-3xl.md:text-4xl.font-extrabold.mb-2{style: 'color: #3a6363'} Bookings Management
        %p.text-sm.sm:text-base.md:text-lg.text-gray-600 Manage all bookings for your cars
      .flex.flex-wrap.gap-2.sm:gap-3.justify-center.md:justify-start
        .bg-blue-50.rounded-lg.p-2.sm:p-3.md:p-4.text-center.flex-1.min-w-20.sm:min-w-24
          %div.text-lg.sm:text-xl.md:text-2xl.font-bold.text-blue-600= @bookings.count
          %div.text-xs.sm:text-sm.text-gray-600 Total
        .bg-green-50.rounded-lg.p-2.sm:p-3.md:p-4.text-center.flex-1.min-w-20.sm:min-w-24
          %div.text-lg.sm:text-xl.md:text-2xl.font-bold.text-green-600= @bookings.where(payment_status: 'paid').count
          %div.text-xs.sm:text-sm.text-gray-600 Paid
        .bg-yellow-50.rounded-lg.p-2.sm:p-3.md:p-4.text-center.flex-1.min-w-20.sm:min-w-24
          %div.text-lg.sm:text-xl.md:text-2xl.font-bold.text-yellow-600= @bookings.where(payment_status: 'pending').count
          %div.text-xs.sm:text-sm.text-gray-600 Pending

  / Filters Section
  .bg-white.rounded-lg.sm:rounded-xl.shadow-lg.p-4.sm:p-6.mb-4.sm:mb-6.md:mb-8
    %h2.text-base.sm:text-lg.md:text-xl.font-bold.mb-3.sm:mb-4.flex.items-center.gap-2{style: 'color: #3a6363'}
      %i.fas.fa-filter.text-sm.sm:text-base{style: 'color:#3A6363'}
      Filter & Search
    = form_with url: vendors_bookings_path, method: :get, local: true, class: 'flex flex-wrap items-end gap-3 sm:gap-4' do |f|
      .field.w-full.sm:flex-1.sm:min-w-48
        = f.label :search, 'Search Customer', class: 'block text-xs sm:text-sm font-medium text-gray-700 mb-1'
        = f.text_field :search, value: params[:search], placeholder: 'Name or email...', class: 'w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500'

      .field.w-full.sm:flex-1.sm:min-w-48
        = f.label :status, 'Booking Status', class: 'block text-xs sm:text-sm font-medium text-gray-700 mb-1'
        = f.select :status, options_for_select([['All Statuses', ''], ['Pending', 'pending'], ['Confirmed', 'confirmed'], ['Cancelled', 'cancelled']], params[:status]), {}, { class: 'w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500' }

      .field.w-full.sm:flex-1.sm:min-w-48
        = f.label :payment_status, 'Payment Status', class: 'block text-xs sm:text-sm font-medium text-gray-700 mb-1'
        = f.select :payment_status, options_for_select([['All Payments', ''], ['Pending', 'pending'], ['Paid', 'paid'], ['Unpaid', 'unpaid'], ['Refunded', 'refunded'], ['Refund Pending', 'refund_pending']], params[:payment_status]), {}, { class: 'w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500' }

      .field.w-full.sm:flex-1.sm:min-w-48
        = f.label :start_date, 'From Date', class: 'block text-xs sm:text-sm font-medium text-gray-700 mb-1'
        = f.date_field :start_date, value: params[:start_date], class: 'w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500'

      .field.w-full.sm:flex-1.sm:min-w-48
        = f.label :end_date, 'To Date', class: 'block text-xs sm:text-sm font-medium text-gray-700 mb-1'
        = f.date_field :end_date, value: params[:end_date], class: 'w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500'

      .field.w-full.sm:flex-shrink-0.flex.flex-col.sm:flex-row.gap-2
        = f.submit 'Apply Filters', class: 'bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 sm:px-6 py-2 rounded-lg transition flex items-center justify-center gap-2 text-sm sm:text-base'
        = link_to 'Clear Filters', vendors_bookings_path, class: 'bg-gray-500 hover:bg-gray-600 text-white font-semibold px-4 sm:px-6 py-2 rounded-lg transition flex items-center justify-center gap-2 text-sm sm:text-base'

  / Bookings Table
  .bg-white.rounded-lg.sm:rounded-xl.shadow-lg.overflow-hidden
    .p-4.sm:p-6.border-b.border-gray-200
      %h2.text-base.sm:text-lg.md:text-xl.font-bold.flex.items-center.gap-2{style: 'color: #3a6363'}
        %i.fas.fa-calendar-alt.text-sm.sm:text-base{style: 'color:#3A6363'}
        Bookings List
        - if params[:search].present? || params[:status].present? || params[:car_id].present?
          %span.text-xs.sm:text-sm.font-normal.text-gray-500.ml-2 (#{@bookings.count} results)

    - if @bookings.any?
      / Mobile Card View (hidden on md and up)
      .md:hidden
        - @bookings.each do |booking|
          .border-b.border-gray-200.p-4.hover:bg-gray-50.transition
            .flex.items-start.justify-between.mb-3
              .flex-1
                %div.text-xs.text-gray-500.mb-1 Booking ID
                %div.font-mono.text-sm.font-semibold.text-gray-900 ##{booking.id}
              .flex.gap-2
                = link_to vendors_booking_path(booking), class: 'text-blue-600 hover:text-blue-800 transition p-2' do
                  %i.fas.fa-eye
                - if booking.status == 'Pending'
                  = link_to vendors_booking_path(booking), method: :patch, data: { confirm: 'Confirm this booking?' }, class: 'text-green-600 hover:text-green-800 transition p-2' do
                    %i.fas.fa-check

            .space-y-2
              .flex.justify-between.items-start
                %span.text-xs.text-gray-500 Customer
                %span.text-sm.font-medium.text-gray-900.text-right= booking.user&.full_name || 'N/A'

              .flex.justify-between.items-start
                %span.text-xs.text-gray-500 Car
                .text-right
                  %div.text-sm.font-medium.text-gray-900= "#{booking.car.brand} #{booking.car.model}"
                  %div.text-xs.text-gray-500= "#{booking.car.year} â€¢ #{booking.car.color}"

              .flex.justify-between.items-center
                %span.text-xs.text-gray-500 Dates
                .text-right
                  %div.text-sm.text-gray-900= booking.start_date.strftime('%b %d, %Y')
                  %div.text-sm.text-gray-900= booking.end_date.strftime('%b %d, %Y')
                  %div.text-xs.text-gray-500= "#{(booking.end_date - booking.start_date).to_i} days"

              .flex.justify-between.items-center
                %span.text-xs.text-gray-500 Status
                - status_classes = {'Pending' => 'bg-yellow-100 text-yellow-700', 'Confirmed' => 'bg-green-100 text-green-700', 'Cancelled' => 'bg-red-100 text-red-700'}
                %span.inline-block.rounded-full.text-xs.font-semibold.px-2.py-1{class: status_classes[booking.status] || 'bg-gray-100 text-gray-700'}= booking.status

              .flex.justify-between.items-center
                %span.text-xs.text-gray-500 Payment
                - payment_status_classes = {'paid' => 'bg-green-100 text-green-700', 'pending' => 'bg-yellow-100 text-yellow-700', 'unpaid' => 'bg-red-100 text-red-700', 'refunded' => 'bg-purple-100 text-purple-700', 'refund_pending' => 'bg-orange-100 text-orange-700'}
                %span.inline-block.px-2.py-1.rounded-full.text-xs.font-semibold{class: payment_status_classes[booking.payment_status] || 'bg-gray-100 text-gray-700'}= booking.payment_status.titleize

              .flex.justify-between.items-center
                %span.text-xs.text-gray-500 Payment Mode
                - payment_mode_classes = {'Cash' => 'bg-yellow-100 text-yellow-700', 'Online' => 'bg-green-100 text-green-700'}
                %span.inline-block.rounded-full.text-xs.font-semibold.px-2.py-1{class: payment_mode_classes[booking.payment_mode] || 'bg-gray-100 text-gray-700'}= booking.payment_mode

              .flex.justify-between.items-center
                %span.text-xs.text-gray-500 Total
                - if booking.total_amount
                  .text-right
                    - if booking.has_discount?
                      %div.text-xs.text-gray-400.line-through= number_to_currency(booking.calculate_total_amount_without_discount + (booking.delivery_charge || 0))
                      %div.text-sm.font-semibold.text-green-600.flex.items-center.gap-1.justify-end
                        %i.fas.fa-tag.text-xs
                        = number_to_currency(booking.total_amount)
                    - else
                      %span.text-sm.font-semibold.text-gray-900= number_to_currency(booking.total_amount)
                - else
                  %span.text-sm.text-gray-400 N/A

      / Desktop Table View (hidden on mobile)
      .hidden.md:block.overflow-x-auto
        %table.min-w-full
          %thead.bg-gray-50
            %tr
              %th.px-6.py-4.text-left.text-xs.font-semibold.text-gray-600.uppercase.tracking-wider Booking ID
              %th.px-6.py-4.text-left.text-xs.font-semibold.text-gray-600.uppercase.tracking-wider Customer
              %th.px-6.py-4.text-left.text-xs.font-semibold.text-gray-600.uppercase.tracking-wider Car
              %th.px-6.py-4.text-left.text-xs.font-semibold.text-gray-600.uppercase.tracking-wider Dates
              %th.px-6.py-4.text-left.text-xs.font-semibold.text-gray-600.uppercase.tracking-wider Status
              %th.px-6.py-4.text-left.text-xs.font-semibold.text-gray-600.uppercase.tracking-wider Payment
              %th.px-6.py-4.text-left.text-xs.font-semibold.text-gray-600.uppercase.tracking-wider Payment Mode
              %th.px-6.py-4.text-left.text-xs.font-semibold.text-gray-600.uppercase.tracking-wider Total
              %th.px-6.py-4.text-left.text-xs.font-semibold.text-gray-600.uppercase.tracking-wider Actions
          %tbody.divide-y.divide-gray-200
            - @bookings.each do |booking|
              %tr.hover:bg-gray-50.transition
                %td.px-6.py-4.whitespace-nowrap
                  %span.font-mono.text-sm.text-gray-900 ##{booking.id}
                %td.px-6.py-4.whitespace-nowrap
                  .flex.flex-col
                    %span.font-medium.text-gray-900= booking.user&.full_name || 'N/A'
                %td.px-6.py-4.whitespace-nowrap
                  .flex.flex-col
                    %span.font-medium.text-gray-900= "#{booking.car.brand} #{booking.car.model}"
                    %span.text-sm.text-gray-500= booking.car.year
                    %span.text-xs.text-gray-400= booking.car.color
                %td.px-6.py-4.whitespace-nowrap
                  .flex.flex-col
                    %span.text-sm.text-gray-900= booking.start_date.strftime('%b %d, %Y')
                    %span.text-sm.text-gray-900= booking.end_date.strftime('%b %d, %Y')
                    %span.text-xs.text-gray-500= "#{(booking.end_date - booking.start_date).to_i} days"
                %td.px-6.py-4.whitespace-nowrap
                  - status_classes = {'Pending' => 'bg-yellow-100 text-yellow-700', 'Confirmed' => 'bg-green-100 text-green-700', 'Cancelled' => 'bg-red-100 text-red-700'}
                  %span.inline-block.rounded-full.text-xs.font-semibold.px-3.py-1{class: status_classes[booking.status] || 'bg-gray-100 text-gray-700'}= booking.status
                %td.px-6.py-4.whitespace-nowrap
                  - payment_status_classes = {'paid' => 'bg-green-100 text-green-700', 'pending' => 'bg-yellow-100 text-yellow-700', 'unpaid' => 'bg-red-100 text-red-700', 'refunded' => 'bg-purple-100 text-purple-700', 'refund_pending' => 'bg-orange-100 text-orange-700'}
                  %span.inline-block.px-3.py-1.rounded-full.text-xs.font-semibold{class: payment_status_classes[booking.payment_status] || 'bg-gray-100 text-gray-700'}= booking.payment_status.titleize
                %td.px-6.py-4.whitespace-nowrap
                  - payment_mode_classes = {'Cash' => 'bg-yellow-100 text-yellow-700', 'Online' => 'bg-green-100 text-green-700'}
                  %span.inline-block.rounded-full.text-xs.font-semibold.px-3.py-1{class: payment_mode_classes[booking.payment_mode] || 'bg-gray-100 text-gray-700'}= booking.payment_mode
                %td.px-6.py-4.whitespace-nowrap
                  - if booking.total_amount
                    - if booking.has_discount?
                      .flex.flex-col
                        %span.text-xs.text-gray-400.line-through= number_to_currency(booking.calculate_total_amount_without_discount + (booking.delivery_charge || 0))
                        %span.font-semibold.text-green-600.flex.items-center.gap-1
                          %i.fas.fa-tag.text-xs
                          = number_to_currency(booking.total_amount)
                    - else
                      %span.font-semibold.text-gray-900= number_to_currency(booking.total_amount)
                  - else
                    %span.text-gray-400 N/A
                %td.px-6.py-4.whitespace-nowrap
                  .flex.gap-2
                    = link_to vendors_booking_path(booking), class: 'text-blue-600 hover:text-blue-800 transition' do
                      %i.fas.fa-eye
                    - if booking.status == 'Pending'
                      = link_to vendors_booking_path(booking), method: :patch, data: { confirm: 'Confirm this booking?' }, class: 'text-green-600 hover:text-green-800 transition' do
                        %i.fas.fa-check
    - else
      .text-center.py-8.sm:py-12
        %i.fas.fa-calendar-times.text-3xl.sm:text-4xl.text-gray-300.mb-3.sm:mb-4
        %p.text-gray-500.text-base.sm:text-lg No bookings found.
        - if params[:search].present? || params[:status].present? || params[:car_id].present?
          %p.text-gray-400.text-xs.sm:text-sm Try adjusting your filters.
          = link_to 'Clear all filters', vendors_bookings_path, class: 'text-blue-600 hover:text-blue-800 font-medium text-sm'
        - else
          %p.text-gray-400.text-xs.sm:text-sm When customers book your cars, they will appear here. 