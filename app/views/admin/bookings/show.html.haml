-# Admin Booking Show Page
.container.mx-auto.px-4.py-8
  %h1.text-3xl.font-bold.text-blue-900.mb-6 Booking Details

  .bg-white.shadow-lg.rounded-xl.overflow-hidden.p-8.mb-8
    %h2.text-xl.font-bold.text-blue-900.mb-4 Booking Info
    %div.flex.flex-wrap.gap-8
      .flex-1
        %div.text-gray-700.mb-2
          %span.font-semibold.text-gray-800 Booking ID:
          = @booking.id
        %div.text-gray-700.mb-2
          %span.font-semibold.text-gray-800 Status:
          = @booking.status
        %div.text-gray-700.mb-2
          %span.font-semibold.text-gray-800 Payment:
          - if @booking.payment_processed?
            %span.inline-block.bg-green-100.text-green-700.rounded-full.px-3.py-1.text-xs.font-semibold Paid
          - else
            %span.inline-block.bg-red-100.text-red-700.rounded-full.px-3.py-1.text-xs.font-semibold Unpaid
        %div.text-gray-700.mb-2
          %span.font-semibold.text-gray-800 Start Date:
          = @booking.start_date
        %div.text-gray-700.mb-2
          %span.font-semibold.text-gray-800 End Date:
          = @booking.end_date
    
    / Vendor Assignment Section - Under Booking Info
    .mt-6.pt-6.border-t.border-gray-200
      %h3.text-lg.font-semibold.text-blue-900.mb-4 Change Vendor Assignment
      = form_with model: [:admin, @booking], local: true, method: :patch, class: 'flex items-center gap-4' do |f|
        .flex.items-center.gap-2
          = f.label :vendor_id, 'Assign to Vendor:', class: 'text-sm font-medium text-gray-700 whitespace-nowrap'
          = f.select :vendor_id, 
              options_from_collection_for_select(@vendors, :id, :company_name, @booking.vendor_id),
              { prompt: 'Select a vendor...' }, 
              { class: 'px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 min-w-64' }
        = f.submit 'Update Vendor', class: 'px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:ring-2 focus:ring-blue-500'
      
      - if @booking.vendor.present?
        .mt-4.p-4.bg-green-50.border.border-green-200.rounded-lg
          %p.text-green-700.font-medium
            %i.fas.fa-check-circle.mr-2
            Currently assigned to: #{@booking.vendor.company_name}
      - else
        .mt-4.p-4.bg-yellow-50.border.border-yellow-200.rounded-lg
          %p.text-yellow-700.font-medium
            %i.fas.fa-exclamation-triangle.mr-2
            No vendor assigned to this booking

  .grid.grid-cols-1.md:grid-cols-2.gap-8
    / Car Info
    .bg-white.shadow-lg.rounded-xl.overflow-hidden.p-8
      %h2.text-xl.font-bold.text-blue-900.mb-4 Car Info
      - car = @booking.car
      - if car
        %div.flex.items-center.gap-4.mb-2
          %div.font-semibold.text-lg= car.brand + ' ' + car.model
          %div.text-gray-500= car.year
        %div.text-gray-700.mb-2
          %span.font-semibold.text-gray-800 Category:
          = car.category
        %div.text-gray-700.mb-2
          %span.font-semibold.text-gray-800 Color:
          = car.color
        %div.text-gray-700.mb-2
          %span.font-semibold.text-gray-800 Price per day:
          = number_to_currency(car.daily_price)
        %div.text-gray-700.mb-2
          -# %span.font-semibold.text-gray-800 View Car:
          = link_to admin_car_path(car), class: 'text-blue-500 hover:text-blue-700' do
            -# %i.fas.fa-eye.mr-2
            View Car Details
      - else
        %div.text-gray-500 Car not found.

    / Vendor Info - Shows assigned vendor, not car owner
    .bg-white.shadow-lg.rounded-xl.overflow-hidden.p-8
      %h2.text-xl.font-bold.text-blue-900.mb-4 Assigned Vendor
      - vendor = @booking.vendor
      - if vendor
        %div.flex.items-center.gap-4.mb-4
          -# = image_tag(vendor.company_logo.presence || image_path('placeholder-avatar.png'), class: 'w-16 h-16 object-cover rounded')
          %div
            %div.font-semibold.text-lg= vendor.company_name
            %div.text-gray-500= vendor.name
        %div.text-gray-700.mb-2
          %span.font-semibold.text-gray-800 Email:
          = vendor.email
        %div.text-gray-700.mb-2
          %span.font-semibold.text-gray-800 Phone:
          = vendor.phone
        %div.text-gray-700.mb-2
          %span.font-semibold.text-gray-800 Address:
          = vendor.address
        .mt-4.p-3.bg-blue-50.border.border-blue-200.rounded-lg
          %p.text-blue-700.text-sm
            %i.fas.fa-info-circle.mr-2
            This vendor is assigned to handle this booking
      - else
        .text-center.py-8
          %i.fas.fa-exclamation-triangle.text-4xl.text-gray-300.mb-4
          %p.text-gray-500 No vendor assigned to this booking
          %p.text-sm.text-gray-400 Please assign a vendor using the dropdown above

  .mt-8.bg-white.shadow-lg.rounded-xl.overflow-hidden.p-8
    %h2.text-xl.font-bold.text-blue-900.mb-4 Customer Info
    - user = @booking.user
    - if user
      %div.font-semibold.text-lg= user.full_name.presence || user.email
      %div.text-gray-500.mb-2= user.email
      %div.text-gray-500.mb-2= user.phone
      %div.text-gray-500.mb-2= user.home_address
      %div.text-gray-500.mb-2= user.nationality
      %div.text-gray-500.mb-2= user.created_at.strftime('%b %d, %Y')
    - else
      %div.text-gray-500 User not found. 
      